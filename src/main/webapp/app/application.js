/*! admin 2017-06-07 */

Ext.define("Admin.store.API",{extend:"Ext.data.Store",alias:"store.api",remoteFilter:!0,pageSize:50,proxy:{type:"api"},constructor:function(a){this.callParent([a])}}),Ext.define("Admin.proxy.API",{extend:"Ext.data.proxy.Ajax",alias:"proxy.api",pageParam:"pageNo",limitParam:"pageSize",reader:{type:"json",rootProperty:function(a){return a.rows||a},totalProperty:"total",keepRawData:!0},writer:{type:"json",writeAllFields:!0},constructor:function(a){this.callParent([a])}}),Ext.define("Admin.controller.AppController",{extend:"Ext.app.Controller",namespace:"Admin",requires:[],stores:[],config:{control:{"#":{unmatchedroute:"onRouteChange"},"navigation-tree":{itemclick:"onNavigationTreeSelectionChange"},contentPanel:{beforeremove:"onContentPanelSubClose",tabchange:"positionedchange"}},refs:{viewport:"viewport",login:"login",navigationTree:"navigation-tree",contentPanel:"contentPanel"},routes:{":node":{before:"onBeforeHandleRoute",action:"onRouteChange"}}},lastView:null,loginViewType:"login",setCurrentView:function(a){a=a||"";var b,c=this,d=c.getContentPanel(),e=d.getLayout(),f=c.getNavigationTree(),g=f.getStore(),h=g.findNode("routeId",a)||g.findNode("viewType",a),i=h&&h.get("viewType")||"page404",j=c.lastView,k=d.child("component[routeId="+a+"]");if(h.get("split")){var l=i.split("-");i=l.slice(0,l.length-1).join("-")}if(j&&j.isWindow&&j.destroy(),j=e.getActiveItem(),!k)if(h){var m=h.get("text"),n=h.get("iconCls"),o=h.get("description");if(a==c.loginViewType)b=Ext.create({xtype:c.loginViewType});else try{b=Ext.create({id:"main-panel-"+a,xtype:o?"panel":i,html:o||"",title:m,iconCls:n,routeId:a,hideMode:"offsets"})}catch(a){return void Ext.ux.Msg.error(a.message,a.name)}}else try{b=Ext.create({xtype:i,routeId:a,hideMode:"offsets"})}catch(a){return void Ext.ux.Msg.error(a.message,a.name)}b&&b.isWindow||(k?(k!==j&&e.setActiveItem(k),b=k):(Ext.suspendLayouts(),e.setActiveItem(d.add(b)),Ext.resumeLayouts(!0))),h&&(h.isRoot()?f.ensureVisible(0,{focus:!0}):(h.parentNode&&!h.parentNode.isExpanded()&&h.parentNode.expand(),f.ensureVisible(h,{focus:!0,select:!0}))),b.isFocusable(!0)&&b.focus(),c.lastView=b},onBeforeHandleRoute:function(a,b){var c=this,d=c.getNavigationTree(),e=d.getStore(),f=e.findNode("viewType",a);f?b.resume():0===e.getCount()?e.on("load",function(){f=e.findNode("viewType",a),f?b.resume():(Ext.ux.Msg.error("找不到viewType为【"+a+"】 的组件","路由跳转失败"),b.stop())}):(Ext.ux.Msg.error("找不到viewType为【"+a+"】 的组件","路由跳转失败"),b.stop())},onRouteChange:function(a){this.setCurrentView(a)},onNavigationTreeSelectionChange:function(a,b,c,d,e,f){var g=b&&(b.get("routeId")||b.get("viewType"));g&&this.redirectTo(g)},onContentPanelSubClose:function(a,b,c){if(2==a.items.getCount())this.redirectTo("");else{var d=a.items,e=d.length,b=d.getAt(e-2),f=b.routeId;if(!0===b.noRoute)return;this.redirectTo(f)}},positionedchange:function(a,b){!0!==b.noRoute&&this.redirectTo(b.routeId||"")}}),Ext.define("Admin.view.common.window.BaseWindow",{extend:"Ext.window.Window",xtype:"basewindow",layout:"fit",width:500,bodyPadding:5,modal:!0,closeAction:"hide",closeToolText:"关闭窗口",constrain:!0,constrainHeader:!0,maximizable:!0,resizable:!1}),Ext.define("Admin.view.common.window.BaseFormWindow",{extend:"Ext.window.Window",title:"新增",iconCls:"x-fa fa-floppy-o",width:400,layout:"fit",modal:!0,closeAction:"hide",closeToolText:"关闭窗口",constrain:!0,constrainHeader:!0,maximizable:!0,resizable:!1,border:!1,keyMap:{"CTRL+ENTER":"onSubmitBtnClicked",scope:"controller"},listeners:{beforeclose:function(){this.down("form").getForm().reset()}}}),Ext.define("Admin.view.common.panel.BaseGridPanel",{extend:"Ext.grid.Panel",viewConfig:{enableTextSelection:!0,emptyText:"<h3>没有数据</h3>"},selModel:{selType:"checkboxmodel"},bbar:{xtype:"pagingtoolbar",displayInfo:!0},columnLines:!0,loadMask:!0,initComponent:function(){this.callParent()}}),Ext.define("Admin.view.common.panel.BaseSearchPanel",{extend:"Ext.panel.Panel",layout:{type:"vbox",pack:"start",align:"begin"},bodyPadding:"5px",margin:"0 0 5px 0",defaults:{layout:{type:"hbox"},border:!1},subDefaults:{margin:"5px 5px",labelAlign:"left",labelWidth:60},keyMap:{ENTER:"onSearchPanelQuery",scope:"controller"}}),Ext.define("Admin.view.common.charts.BaseChart",{extend:"Ext.Panel",height:580,layout:"fit",bodyPadding:5,platformConfig:{classic:{headerPosition:"top"},modern:{header:{docked:"top"}}},collapsible:!0,titleCollapse:!0}),Ext.define("Admin.view.login.LoginController",{extend:"Ext.app.ViewController",alias:"controller.login",onResetBtnClicked:function(){this.getView().down("form").getForm().reset()},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();d.isValid()&&d.submit({url:"/cn/admin/login",method:"POST",submitEmptyText:!1,success:function(a,b){switch(b.result.result){case"success":window.location.reload();break;case"failed":Ext.Msg.alert({title:"提示",msg:"登录失败，账户名或账户密码错误",buttons:Ext.Msg.OK,fn:"",icon:Ext.Msg.ERROR})}},failure:function(a,b){Ext.Msg.alert({title:"提示",msg:"服务器端异常，请联系管理员",buttons:Ext.Msg.OK,fn:"",icon:Ext.Msg.ERROR})}})}}),Ext.define("Admin.view.main.MainModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.main",data:{ename:"hmlzs",cname:"老祖寺后台",adminUser:_am.currentUser.name,currentView:null}}),Ext.define("Admin.view.login.Login",{extend:"Ext.window.Window",xtype:"login",requires:[],title:"帐号登录",iconCls:"x-fa fa-user",bodyPadding:5,width:400,frame:!0,modal:!0,closeAction:"hide",closable:!1,constrain:!0,constrainHeader:!0,resizable:!1,autoShow:!0,controller:"login",viewModel:"main",keyMap:{ENTER:"onSubmitBtnClicked",scope:"controller"},defaults:{border:!1},initComponent:function(){var a=this;Ext.apply(a,{items:[{html:'<img src="http://www.hmlzs.cn/static/lzs/images/logo.png" width="281" height="58"/>',userCls:"admin-login-logo"},{xtype:"form",url:_am.login.submitURL+location.search,method:"POST",baseCls:"x-plain",layout:"form",defaults:{anchor:"100%",labelWidth:60,labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{fieldLabel:"帐号",name:"account",reference:"username",publishes:"value",allowBlank:!1,blankText:"请填写您的帐号"},{inputType:"password",name:"password",fieldLabel:"密码",allowBlank:!1,blankText:"请填写您的帐号密码"}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"登录",iconCls:"x-fa fa-sign-in",tooltip:"快捷键：Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]}]}),a.callParent()}}),Ext.define("Admin.view.main.MainController",{extend:"Ext.app.ViewController",alias:"controller.main",onMainViewRender:function(){var a=Ext.Object.fromQueryString(location.search),b=(a.ref,a.module||"");this.redirectTo(b)}}),Ext.define("Admin.view.main.region.NavigationTree",{extend:"Ext.tree.Panel",xtype:"navigation-tree",id:"navigation-tree",title:"菜单",iconCls:"x-fa fa-bars",rootVisible:!1,lines:!1,useArrows:!0,width:250,height:200,stateful:!0,stateId:"mainnav.west",collapsible:!0,titleCollapse:!0,enableColumnResize:!1,enableColumnMove:!1,store:"navigation"}),Ext.define("Admin.view.main.region.ContentTabPanel",{extend:"Ext.tab.Panel",xtype:"contentPanel",id:"content-tabpanel",viewModel:{type:"main"},header:{hidden:!0},defaults:{closable:!0,closeAction:"destory"},plugins:[Ext.create("Ext.ux.TabCloseMenu"),"tabreorderer"],items:{title:"工作台",id:"workbench",iconCls:"x-fa fa-home",closable:!1,scrollable:"y",xtype:"workbench"}}),Ext.define("Admin.view.main.Main",{extend:"Ext.panel.Panel",plugins:["viewport"],requires:[],controller:"main",viewModel:"main",layout:"border",border:!1,icon:"http://www.pconline.com.cn/favicon.ico",initComponent:function(){var a=this;Ext.apply(a,{header:{baseCls:"x-panel-body",border:!1,height:60,items:[{xtype:"image",src:"http://www.hmlzs.cn/static/lzs/images/logo.png",userCls:"admin-header-logo"},{xtype:"tbtext",userCls:"x-fa fa-user",bind:{text:" {adminUser}，欢迎您！"}},{xtype:"tbtext",userCls:"x-fa fa-sign-out",html:' <a href="logout">退出</a>'}]},items:[{region:"west",xtype:"navigation-tree",split:!0},{region:"center",xtype:"contentPanel"}]}),a.callParent()}}),Ext.define("Admin.view.common.window.MoveWindow",{extend:"Ext.window.Window",xtype:"move-window",reference:"moveWindow",layout:"fit",width:300,height:250,scrollable:!0,bodyPadding:10,title:"请选择目标分类",modal:!0,closeAction:"hide",closeToolText:"关闭窗口",constrain:!0,constrainHeader:!0,resizable:!1}),Ext.define("Admin.view.common.window.MovePanel",{extend:"Admin.view.common.window.MoveWindow",xtype:"moveCategoty-tree",alias:"widget.moveCategoty-tree",controller:"content",initComponent:function(){var a=this;Ext.apply(a,{items:{xtype:"treepanel",checkPropagation:"both",rootVisible:!1,useArrows:!0,bufferedRenderer:!1,animate:!0,store:{xtype:"store",proxy:{type:"ajax",url:"data/category.json",reader:{type:"json",rootProperty:"children"},autoLoad:!0}},listeners:{beforecheckchange:"onBeforeCheckChange"}},bbar:["->",{xtype:"button",text:"确定",handler:"submitBtnOK"},{xtype:"button",text:"取消",handler:"moveBtnCancel"}]}),a.callParent()}}),Ext.define("Admin.controller.ViewController",{extend:"Ext.app.ViewController",requires:[],config:{searchPrefix:"search-",searchGridSuffix:"-mgrid"},getContentPanel:function(){return Admin.app.getController("AppController").getContentPanel()},onSearchPanelQuery:function(){var a=this,b=a.getView(),c=a.getSearchPrefix(),d=a.getSearchGridSuffix(),e=b.query("[itemId^="+c+"]"),f=b.down(b.xtype+d),g=f.getStore(),h=[];Ext.each(e,function(a,b,d){var e=a.itemId.slice(c.length),f=a.getValue();f&&"string"==typeof f?f=f.indexOf("全部")>-1?"":f:"datefield"==a.xtype&&(f=Ext.Date.format(f,"Y-m-d H:i:s")),h.push({property:e,value:f})}),g.getRemoteFilter()||g.setRemoteFilter(!0),g.setFilters(h)},onSearchPanelReset:function(){var a=this,b=a.getView(),c=a.getSearchPrefix(),d=a.getSearchGridSuffix(),e=b.query("[itemId^="+c+"]"),f=b.down(b.xtype+d),g=f.getStore();Ext.each(e,function(a,b,c){a.setValue("")}),g.clearFilter()},formSubmit:function(a,b,c){var d=Ext.apply({submitEmptyText:!1,url:"",waitMsgTarget:!0,waitMsg:"请稍候...",success:c,failure:Ext.ux.formFailure},b);a.submit(d)},sendAjaxFromIds:function(a,b,c,d){if(!a)return void Ext.log("缺少action");var e=[];if(Ext.each(c.getSelection(),function(a,b,c){0!==a.id&&e.push(a.id)}),0!=e.length){var f=Ext.apply({url:"",params:{method:a,ids:e},success:function(a,d){var e=Ext.decode(a.responseText),f=e.success;e.msg;f?Ext.ux.Msg.info(b+"成功",function(){c.getStore().reload(),c.getSelectionModel().deselectAll()}):Ext.ux.Msg.ajaxFailure(a,d)},failure:Ext.ux.Msg.ajaxFailure},d);if("move"==a){var g=this,h=g.getView(),i=g.lookupReference("moveWindow");i||(i=Ext.create({xtype:"moveCategoty-tree",reference:"moveWindow",ids:e}),h.add(i)),i.show()}else Ext.MessageBox.confirm("提示","共选中【"+e.length+"】项，确定要【"+b+"】吗？",function(a){"no"!==a&&Ext.Ajax.request(f)})}},sendAjaxFromData:function(a,b,c,d){if(!a)return void Ext.log("缺少action");var e=[];if(Ext.each(c.getSelection(),function(a,b,c){a.dirty&&e.push(a.data)}),0!=e.length){var f=Ext.apply({url:"",params:{method:a,data:Ext.util.JSON.encode(e)},success:function(a,d){var e=Ext.decode(a.responseText),f=e.success;e.msg;f?Ext.ux.Msg.info(b+"成功",function(){c.getStore().reload(),c.getSelectionModel().deselectAll()}):Ext.ux.Msg.ajaxFailure(a,d)},failure:Ext.ux.Msg.ajaxFailure},d);Ext.MessageBox.confirm("提示","共选中【"+e.length+"】项，确定要【"+b+"】吗？",function(a){"no"!==a&&Ext.Ajax.request(f)})}},onRefreshBtnClicked:function(a){var b=a.up("grid"),c=a.up("grid").getStore();c.getProxy().setExtraParam("page",1),c.reload(),b.getSelectionModel().deselectAll()},onResetBtnClicked:function(a){this.getView().down("form").reset()},onBtnClicked:function(a){Ext.log(a.text)},onClickBtnPublish:function(a){var b=a.up().up().up().down("grid");Ext.Ajax.request({url:"/cn/article/create/index",method:"POST",params:{userId:_am.currentUser.id},waitMsg:"正在发布，请稍候...",success:function(a){JSON.parse(a.responseText).success?Ext.ux.Msg.info("发布成功",function(){b.getStore().reload(),b.getSelectionModel().deselectAll()}):Ext.ux.Msg.info("发布失败，请稍候再试...",function(){b.getStore().reload(),b.getSelectionModel().deselectAll()})}})},setCurrentView:function(a){a=Ext.apply({xtype:"panel",window:!1,openWindow:!1,inWindow:!1,windowCfg:{},targetCfg:{}},a);var b=a.xtype,c=a.window,d=a.inWindow,e=a.openWindow,f=a.windowCfg,g=a.targetCfg;if(d){var h=Ext.apply({xtype:"basewindow",items:[Ext.apply({xtype:b},g)]},f);Ext.create(h)}else if(e){var h=Ext.apply({xtype:"basewindow",autoShow:!0},f);Ext.create(h)}else if(c){var h=Ext.apply({xtype:b,autoShow:!0},g);Ext.create(h)}else Ext.log("setCurrentView 调用参数错误")}}),Ext.define("Admin.view.workbench.WorkbenchController",{extend:"Admin.controller.ViewController",alias:"controller.workbench",module:"workbench",url:"Super Awesome",init:function(){console.log(this)},control:{"workbench-sp button[action=search]":{click:"onSearchPanelQuery"},"workbench-sp button[action=reset]":{click:"onSearchPanelReset"},"workbench-mgrid":{selectionchange:"onSelectionChange"},"workbench-mgrid button[action=audit]":{click:"onBtnClicked"},"workbench-mgrid button[action=rework]":{click:"onBtnClicked"},"workbench-mgrid button[action=move]":{click:"onBtnClicked"},"workbench-mgrid button[action=delete]":{click:"onBtnClicked"},"workbench-mgrid button[action=release]":{click:"onBtnClicked"},"workbench-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),d.module),g=e.down(f+d.getSearchGridSuffix()),h=b?b.length:0;0==h&&Ext.log("No selection"),g.down("button[action=audit]").setDisabled(h<1),g.down("button[action=rework]").setDisabled(h<1),g.down("button[action=move]").setDisabled(h<1),g.down("button[action=delete]").setDisabled(h<1),g.down("button[action=release]").setDisabled(h<1)},onBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/article/articleButton?"+a.action})}}),Ext.define("Admin.view.workbench.WorkbenchSearchPanel",{extend:"Admin.view.common.panel.BaseSearchPanel",xtype:"workbench-sp",initComponent:function(){var a=this,b=a.subDefaults;Ext.apply(a,{items:[{defaults:b,items:[{xtype:"textfield",fieldLabel:"文章ID",emptyText:"如：100015",itemId:"search-id"},{xtype:"textfield",fieldLabel:"文章标题",emptyText:"",itemId:"search-title"},{xtype:"datefield",fieldLabel:"开始日期",itemId:"search-startdate",vtype:"daterange",endDateField:"search-enddate",editable:!1,format:"Y-m-d",submitFormat:"Y-m-d"},{xtype:"datefield",fieldLabel:"结束日期",itemId:"search-enddate",vtype:"daterange",editable:!1,startDateField:"search-startdate",format:"Y-m-d",submitFormat:"Y-m-d"},{xtype:"button",text:"查询",iconCls:"x-fa fa-search",action:"search"},{xtype:"button",text:"重置",iconCls:"x-fa fa-undo",action:"reset"}]}]}),a.callParent()}}),Ext.define("Admin.view.workbench.WorkbenchMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"workbench-mgrid",initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Admin.store.API",{remoteFilter:!0,proxy:{type:"ajax",url:"/cn/article/articleList",extraParams:{category:"all"},reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:80},{text:"状态",dataIndex:"status",renderer:a.renderer,width:80},{text:"标题",dataIndex:"title",renderer:a.renderer,flex:1},{text:"栏目",dataIndex:"category",width:150},{text:"作者",dataIndex:"author"},{text:"创建人",dataIndex:"creator"},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"更新时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"审核",iconCls:"x-fa fa-check-circle-o",disabled:!0,action:"audit"},{xtype:"button",text:"返工",iconCls:"x-fa fa-undo",disabled:!0,action:"rework"},{xtype:"button",text:"移动",iconCls:"x-fa fa-exchange",disabled:!0,action:"move"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},{xtype:"button",text:"发布",iconCls:"x-fa fa-paper-plane-o",disabled:!0,action:"release"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"},"->",{xtype:"label",tpl:"共 <strong>{article}</strong> 篇文章，<strong>{picture}</strong> 张图片，<strong>{voice}</strong> 条音频， 感恩您的努力！",style:{color:"crimson"},listeners:{beforerender:function(a,b){Ext.Ajax.request({url:"/cn/article/getFileInfo"}).then(function(b,c){var d=Ext.decode(b.responseText);a.setHtml(d)},function(a,b){Ext.log("server-side failure with status code "+a.status)})}}}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:#0066FF","初稿";case 1:return b.tdStyle="color:blank","已签";case 5:return b.tdStyle="color:#FF6633","返工";case 9:return b.tdStyle="color:blank","已发";case 10:return b.tdStyle="color:red","已删"}case"title":default:return a}}}),Ext.define("Admin.view.workbench.Workbench",{extend:"Ext.panel.Panel",xtype:"workbench",requires:[],controller:"workbench",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"north",xtype:"workbench-sp"},{region:"center",xtype:"workbench-mgrid"},{region:"south",xtype:"homepage"}]}),a.callParent()}}),Ext.define("Admin.view.content.index.nav.NavController",{extend:"Admin.controller.ViewController",alias:"controller.content-index-nav",module:"content-index-nav",url:"Super Awesome",init:function(){console.log(this)},control:{"#nav":{beforerender:"onBeforeRender"},"#nav button[action=audit]":{click:"onBtnClicked"},"#nav button[action=rework]":{click:"onBtnClicked"},"#nav button[action=edit]":{click:"onEditBtnClicked"},"#nav button[action=release]":{click:"onBtnClickedRelease"},"#nav button[action=refresh]":{click:"onRefreshBtnClicked"}},onResetBtnClickedNav:function(a){var b=a.up().up().up().up().id;b=b.split("-"),b=b[b.length-1];var c="sub"==b?"deputy":"main",d=a.up().up().query("[name=content]")[0];Ext.Ajax.request({method:"POST",url:"/cn/article/resetNav",params:{type:c},success:function(a){var b=JSON.parse(a.responseText);b.success&&d.setValue(b.nav)}})},onBtnClickedRelease:function(){Ext.Ajax.request({url:"/cn/article/create/nav",method:"POST",waitMsg:"正在发布，请稍候...",success:function(a){JSON.parse(a.responseText).success?Ext.ux.Msg.info("发布成功",function(){}):Ext.ux.Msg.info("程序异常，请稍后再试...",function(){})}})},onBeforeRender:function(a,b){this.onRefresh(a)},onRefreshBtnClicked:function(){},onRefresh:function(a){var b=this,c=b.getView(),d=c.id.split("-"),d=d[d.length-1];Ext.Ajax.request({url:"main"==d?"/cn/article/articleForId?id=1":"/cn/article/articleForId?id=2"}).then(function(c,d){var e=Ext.decode(c.responseText);a.setHtml(e);var f=e.status,g="",h="";switch(f){case 0:h="#0066FF",g="初稿";break;case 1:h="blank",g="已签";break;case 5:h="#FF6633",g="返工";break;case 9:h="blank",g="已发";break;case 10:h="red",g="已删"}e.statusText=g,e.statusColor=h,b.lookupReference("status").setHtml(e),a.data=e},function(a,b){Ext.log("server-side failure with status code "+a.status)})},onEditBtnClicked:function(a){var b=this,c=b.getView(),d=c.id.split("-"),d=d[d.length-1],e="content-index-nav-mform-"+d,f=b.lookupReference(e);f||(f=Ext.create({reference:e,xtype:"content-index-nav-mform"}),c.add(f)),f.setTitle("修改内嵌"),f.show();var g=c.down("#nav").data,h=f.down("form").getForm(),i=g.content.replace(/,/g,"\n");h.findField("id").setValue(g.id),h.findField("content").setValue(i)},onBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"data/ajax.json?"+a.action})},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();b.formSubmit(d,{url:"/cn/article/updateArticleForId"},function(a,b){Ext.ux.Msg.info("保存成功",function(){c.hide()})})}}),Ext.define("Admin.view.content.index.nav.NavMainForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"content-index-nav-mform",controller:"content-index-nav",width:520,height:400,initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",bodyPadding:10,defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{fieldLabel:"id",name:"id",hidden:!0},{xtype:"textarea",name:"content",allowBlank:!1,height:300}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClickedNav"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.content.index.nav.Nav",{extend:"Ext.panel.Panel",xtype:"content-index-nav",requires:[],controller:"content-index-nav",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{itemId:"nav",tpl:new Ext.XTemplate('<div style="list-style: none;">{[this.formatContent(values.content)]}</div>',{formatContent:function(a){for(var b=a.split(","),c=0;c<b.length;c++)b[c]='<div style="float: left;padding:5px 10px;">'+b[c]+"</div>";return b.join("")}}),tbar:[{xtype:"button",text:"修改",iconCls:"x-fa fa-pencil-square-o",action:"edit"},{xtype:"button",text:"发布",iconCls:"x-fa fa-paper-plane-o",action:"release"},"->",{xtype:"component",reference:"status",tpl:'状态：<span style="color:{statusColor}">{statusText}</span> \x3c!--| 更新人：{updateOne}--\x3e | 更新时间：{updateDate}'}]}]}),a.callParent()}}),Ext.define("Admin.view.content.ContentController",{extend:"Admin.controller.ViewController",alias:"controller.content",module:"content",url:"Super Awesome",init:function(){console.log(this)},control:{"content-sp button[action=search]":{click:"onSearchPanelQuery"},"content-sp button[action=reset]":{click:"onSearchPanelReset"},"content-mgrid":{selectionchange:"onSelectionChange",itemclick:"onItemClick"},"content-mgrid button[action=add]":{click:"onAddBtnClicked"},"content-mgrid button[action=update]":{click:"onUpdateBtnClicked"},"content-mgrid button[action=audit]":{click:"onBtnClicked"},"content-mgrid button[action=rework]":{click:"onBtnClicked"},"content-mgrid button[action=move]":{click:"onBtnClicked"},"content-mgrid button[action=delete]":{click:"onBtnClicked"},"content-mgrid button[action=release]":{click:"onBtnClicked"},"content-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"},"content-mgrid button[action=content-headline-text]":{click:"onTextHeadLineBtnClicked"},"content-mgrid button[action=content-headline-picture]":{click:"onPictureHeadLineBtnClicked"},"content-mgrid button[action=preview]":{click:"onPreviewBtnClicked"}},onUpdateBtnClicked:function(a){var b,c=a.up().up(),d=a.up().up().up().up().up().down("contentPanel"),e=c.getSelection()[0],f=d.add({id:"article-"+e.id,title:e.data.title,noRoute:!0,xtype:"main-panel-article"});Ext.Ajax.request({url:"/cn/article/getArticleKeyWord",method:"POST",async:!1,params:{aId:e.id},success:function(a){var c=a.responseText,d=JSON.parse(c);b=d.rows;for(var e=new Array,f=new Array,g=0;g<b.length;g++)f=[b[g].name],e[g]=f;b=e}}),e.set("kId",b),f.getViewModel().data.article=e,d.setActiveTab(f)},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),e.down("content"+d.getSearchGridSuffix())),g=b?b.length:0,h=!1;b.length>1&&Ext.each(b,function(a,b,c){1!=a.data.status&&(h=!0)}),0==g&&Ext.log("No selection"),f.down("button[action=audit]").setDisabled(g<1),f.down("button[action=rework]").setDisabled(g<1),f.down("button[action=move]").setDisabled(g<1),f.down("button[action=delete]").setDisabled(g<1),f.down("button[action=release]").setDisabled(h),f.down("button[action=preview]").setDisabled(1!=g),f.down("button[action=update]").setDisabled(1!=g)},onItemClick:function(a,b,c,d,e,f){var g=this,h=g.getView(),i=a.getSelection()[0].data.status,j=e.target;if(j){var k=j.getAttribute("action"),l=h.id.split("-"),l=l[l.length-1];switch(k){case"set-text-headline":if(9!=i)return void Ext.ux.Msg.error("请先发布文章，再执行该操作",function(){});var m="content-headline-text-mform-"+l,n=g.lookupReference(m);n||(n=Ext.create({xtype:"content-headline-text-mform",reference:m}),h.add(n)),n.setTitle("新增文字头条"),n.show(),n.down("form").getForm().loadRecord(b);break;case"set-picture-headline":if(9!=i)return void Ext.ux.Msg.error("请先发布文章，再执行该操作",function(){});var m="content-headline-picture-mform-"+l,n=g.lookupReference(m);n||(n=Ext.create({xtype:"content-headline-picture-mform",reference:m}),h.add(n)),n.setTitle("新增图片头条"),n.show(),n.down("form").getForm().loadRecord(b)}}},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=c.id.split("-"),d=d[d.length-1],e="content-mform-"+d,f=b.lookupReference(e),g=null;if("update"==a.action){if(g=c.down("grid").getSelection(),0==g.length)return;g=g[0]}var h=g;if(f||(f=Ext.create({xtype:"content-mform",reference:e,id:d}),c.add(f)),"add"==a.action)f.setTitle("【"+c.getTitle()+"】新增文章");else{var i;Ext.Ajax.request({url:"/cn/article/getArticleKeyWord",method:"POST",async:!1,params:{aId:h.id},success:function(a){var b=a.responseText,c=JSON.parse(b);i=c.rows;for(var d=new Array,e=new Array,f=0;f<i.length;f++)e=[i[f].name],d[f]=e;i=d}});var j=c.down("form");h.set("kId",i),j.getForm().loadRecord(h),f.setTitle("【"+c.getTitle()+"】修改文章")}f.show(),null!=h?editor.html(h.data.content):editor.html("")},onBtnClicked:function(a){var b=this,c=a.up("grid"),d=c.getSelection()[0].data.status;if("发布"==a.text&&(0==d||5==d))return void Ext.ux.Msg.error("请先审核，再执行该操作",function(){});b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/article/articleButton?"+a.action})},onTextHeadLineBtnClicked:function(a){var b=this,c=b.getView(),d=c.id.split("-"),d=d[d.length-1],e="content-headline-text-win-"+d,f=b.lookupReference(e);f||(f=Ext.create({xtype:"headlinewindow",reference:e,viewModel:{data:{category:d,categoryName:c.getTitle(),subItem:"content-headline-text-mgrid",type:"text"}}}),c.add(f)),f.show()},onPictureHeadLineBtnClicked:function(a){var b=this,c=b.getView(),d=c.id.split("-"),d=d[d.length-1],e="content-headline-picture-win-"+d,f=b.lookupReference(e);f||(f=Ext.create({xtype:"headlinewindow",reference:e,viewModel:{data:{category:d,categoryName:c.getTitle(),subItem:"content-headline-picture-mgrid",type:"picture"}}}),c.add(f)),f.show()},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm(),e=d.getValues().id,f="新增";e&&(f="修改"),d.isValid()&&d.submit({url:"/cn/article/createArticle",method:"POST",params:{content:editor.isEmpty()?"":editor.html(),category:c.id,userId:_am.currentUser.id,authorStr:_am.currentUser.name,articleId:e},waitMsg:"正在提交中，请等待片刻...",submitEmptyText:!1,success:function(a,b){var d=b.result.result;b.result.success?Ext.MessageBox.show({title:"操作提示",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,align:"center",message:"文章"+f+"成功",fn:function(a){c.hide(),editor.html("");var b=c.up().down("grid").getStore();b.getProxy().setExtraParam("page",1),b.reload()}}):Ext.MessageBox.show({title:"文章创建失败,请刷新重试",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR,align:"center",message:d,fn:function(a){editor.html("")}})}})},moveBtnCancel:function(a){var b=this.getView().down("treepanel").getChecked();b.length>0&&Ext.each(b,function(a){a.set("checked",!1)}),this.getView().down("treepanel").up("move-window").hide()},onBeforeCheckChange:function(a,b,c){var d=this.getView().down("treepanel").getChecked();b||d.length>0&&Ext.each(d,function(a){a.set("checked",!1)})},submitBtnOK:function(){for(var a=this.getView().up().down("grid"),b=this.getView(),c=a.getSelection(),d=new Array,e=0;e<c.length;e++)d[e]=c[e].id;var f=b.down("treepanel").getChecked();f.length>0&&Ext.each(f,function(c){var e=c.data.viewType;e=e.split("-"),e=e[e.length-1],Ext.Ajax.request({url:"/cn/article/articleChangeCategory",method:"POST",params:{category:e,ids:d},waitMsg:"正在移动中，请等待片刻...",submitEmptyText:!1,success:function(c,d){JSON.parse(c.responseText)?Ext.MessageBox.show({title:"操作提示",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,align:"center",message:"文章移动完成",fn:function(a){b.hide()}}):Ext.MessageBox.show({title:"操作提示",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR,align:"center",message:"文章移动失败，请刷新重试",fn:function(a){b.hide()}});var e=a.getStore();e.getProxy().setExtraParam("page",1),e.reload()}})})},onPreviewBtnClicked:function(a){var b=a.up().up().up().down("grid").getSelection()[0].id;Ext.Ajax.request({method:"POST",url:"/cn/article/articlePreview",params:{id:b},success:function(a){var b=a.responseText;if(b.indexOf("true")>-1){var c=JSON.parse(b),d=c.preview;window.open("http://"+d)}else Ext.ux.Msg.info("发布失败，请稍候再试...",function(){grid.getStore().reload(),grid.getSelectionModel().deselectAll()})}})}}),Ext.define("Admin.view.content.ContentSearchPanel",{extend:"Admin.view.common.panel.BaseSearchPanel",xtype:"content-sp",initComponent:function(){var a=this,b=a.subDefaults;Ext.apply(a,{items:[{defaults:b,items:[{xtype:"textfield",fieldLabel:"文章ID",emptyText:"如：100015",itemId:"search-id"},{xtype:"textfield",fieldLabel:"文章标题",emptyText:"",itemId:"search-title"},{xtype:"datefield",fieldLabel:"开始日期",itemId:"search-startdate",vtype:"daterange",endDateField:"search-enddate",editable:!1,format:"Y-m-d",submitFormat:"Y-m-d",emptyText:""},{xtype:"datefield",fieldLabel:"结束日期",itemId:"search-enddate",vtype:"daterange",editable:!1,startDateField:"search-startdate",format:"Y-m-d",submitFormat:"Y-m-d",emptyText:""},{xtype:"button",text:"查询",iconCls:"x-fa fa-search",action:"search"},{xtype:"button",text:"重置",iconCls:"x-fa fa-undo",action:"reset"}]}]}),a.callParent()}}),Ext.define("Admin.view.content.ContentMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"content-mgrid",actions:{preview:{iconCls:"x-fa fa-file-excel-o c-forestgreen",tooltip:"预览",handler:"onDownloadFileBtnClick"},add:{iconCls:"x-fa fa-file-excel-o c-forestgreen",tooltip:"新增子栏目",handler:"onDownloadFileBtnClick"},article:{iconCls:"x-fa fa-building",tooltip:"文章列表",handler:"onCreateOrderBtnClicked"},headline:{iconCls:"x-fa fa-search-plus",tooltip:"头条列表",handler:"onSearchOrderBtnClicked"},picture:{iconCls:"x-fa fa-calendar",tooltip:"图片列表",handler:"onAdInfoBtnClicked"}},initComponent:function(){var a=this,b=location.hash.split("-"),b=b[b.length-1];Ext.apply(a,{store:Ext.create("Admin.store.API",{remoteFilter:!0,proxy:{type:"ajax",url:"/cn/article/articleList",extraParams:{category:b},reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:80},{text:"sId",dataIndex:"sId",width:80,hidden:!0},{text:"状态",dataIndex:"status",name:"status",renderer:a.renderer,width:80},{text:"标题",dataIndex:"title",renderer:a.renderer,flex:1},{text:"栏目",dataIndex:"category",width:150},{text:"作者",dataIndex:"author"},{text:"创建人",dataIndex:"creator"},{text:"头条",dataIndex:"hAId",renderer:a.renderer},{text:"图片",dataIndex:"hPId",renderer:a.renderer},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"更新时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"新增",iconCls:"x-fa fa-plus-circle",action:"add"},{xtype:"button",text:"审核",iconCls:"x-fa fa-check-circle-o",disabled:!0,action:"audit"},{xtype:"button",text:"返工",iconCls:"x-fa fa-undo",disabled:!0,action:"rework"},{xtype:"button",text:"移动",iconCls:"x-fa fa-exchange",disabled:!0,action:"move"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},{xtype:"button",text:"修改",iconCls:"x-fa fa-recycle",disabled:!0,action:"update"},{xtype:"button",text:"预览",iconCls:"x-fa fa-eye",disabled:!0,action:"preview"},{xtype:"button",text:"发布",iconCls:"x-fa fa-paper-plane-o",disabled:!0,action:"release"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"},"->",{xtype:"button",text:"栏目头条列表",userCls:"admin-label-button",action:"content-headline-text"},{xtype:"button",text:"栏目图片列表",userCls:"admin-label-button",action:"content-headline-picture"}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:#0066FF","初稿";case 1:return b.tdStyle="color:blank","已签";case 5:
return b.tdStyle="color:#FF6633","返工";case 9:return b.tdStyle="color:#7DB336","已发";default:return b.tdStyle="color:red",a}case"hAId":return 0==a?'<button class="x-fa fa-flag admin-label-button admin-color-purple" action="set-text-headline"></button>':'<button class="x-fa fa-flag admin-label-button admin-color-gray" action="cancel-text-headline"></button>';case"hPId":return 0==a?'<button class="x-fa fa-picture-o admin-label-button admin-color-purple" action="set-picture-headline"></button>':'<button class="x-fa fa-picture-o admin-label-button admin-color-gray" action="cancel-picture-headline"></button>';default:return a}}}),Ext.define("Admin.view.content.ContentMainForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"content-mform",controller:"content",maximized:!0,maximizable:!1,viewModel:{data:{article:null}},initComponent:function(){var a=this,b="content-area-"+a.id+(new Date).getTime(),c=Ext.create({xtype:"form",bodyPadding:10,defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",height:"100%",items:[{fieldLabel:"newsId",name:"id",bind:"{article.id}",hidden:!0},{xtype:"fieldcontainer",fieldLabel:"文章标题",layout:"hbox",combineErrors:!0,defaultType:"textfield",items:{name:"title",allowBlank:!1,width:"50%"}},{xtype:"fieldcontainer",fieldLabel:"文章来源",layout:"hbox",combineErrors:!0,defaultType:"textfield",beforeLabelTextTpl:"",items:{name:"source",width:"50%",emptyText:"黄梅老祖寺"}},{xtype:"fieldcontainer",fieldLabel:"作者",name:"authors",beforeLabelTextTpl:"",layout:"hbox",combineErrors:!0,defaultType:"textfield",items:{name:"author",emptyText:_am.currentUser.name,width:"50%"}},{xtype:"fieldcontainer",fieldLabel:"描述",layout:"hbox",combineErrors:!0,defaultType:"textarea",items:[{name:"depict",allowBlank:!1,minLength:5,maxLength:200,width:"50%"},{xtype:"tbtext",userCls:"x-fa fa-info-circle",text:" 50~200个字"}]},{xtype:"fieldcontainer",fieldLabel:"标签",layout:"hbox",combineErrors:!0,defaultType:"textfield",name:"kId",items:[{xtype:"tagfield",name:"kId",store:{proxy:{type:"ajax",url:"/cn/article/getKeyWord",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0},displayField:"name",valueField:"id",queryMode:"local",createNewOnEnter:!0,createNewOnBlur:!0,filterPickList:!0,allowBlank:!1,width:"50%"},{xtype:"tbtext",userCls:"x-fa fa-info-circle",text:"多选，可手动输入（回车或切换焦点即可创建），也可从标签库选择"}]},{xtype:"fieldcontainer",beforeLabelTextTpl:"",fieldLabel:"连载",layout:"hbox",combineErrors:!0,defaultType:"textfield",publishes:"value",items:{xtype:"combobox",name:"sId",store:{proxy:{type:"ajax",url:"/cn/serial/serialQuery?status=5",reader:{type:"json",rootProperty:"rows"}}},displayField:"name",valueField:"id",queryMode:"remote",editable:!1,minChars:1,triggerAction:"all",forceSelection:!0,emptyText:"请选择系列",width:"50%"}},{width:"100%",height:480,border:0,name:"content",xtype:"panel",html:"<textarea id="+b+' style="width: 100%; height: 350px;"></textarea><script>document.getElementById("#content-area").val("")<\/script>',listeners:{afterrender:function(a,c){editor=KindEditor.create("#"+b,{resizeType:1,allowPreviewEmoticons:!1,items:["fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","removeformat","|","justifyleft","justifycenter","justifyright","insertorderedlist","insertunorderedlist","|","table","emoticons","image","link","|","quickformat","pagebreak","fullscreen"],allowFileUpload:!1,uploadJson:"/cn/admin/mediaCreate",fillDescAfterUploadImage:!0,formatUploadUrl:!1,extraFileUploadParams:{type:1,rule:0}})}}}],buttons:[{text:"提交",iconCls:"x-fa fa-floppy-o",name:"content-btn",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:c}),a.callParent()}}),Ext.define("Admin.view.content.headline.HeadLineWindow",{extend:"Admin.view.common.window.BaseWindow",xtype:"headlinewindow",maximizable:!1,maximized:!0,border:!1,initComponent:function(){var a=this,b=a.getViewModel(),c=b.get("category"),d=b.get("categoryName"),e=b.get("type"),f=b.get("subItem");switch(e){case"text":a.setTitle("【"+d+"】栏目文字列表");break;case"picture":a.setTitle("【"+d+"】图片头条列表")}Ext.apply(a,{items:{xtype:f,viewModel:{data:c}}}),a.callParent()}}),Ext.define("Admin.view.content.headline.text.TextController",{extend:"Admin.controller.ViewController",alias:"controller.content-headline-text",module:"content-headline-text",url:"Super Awesome",init:function(){console.log(this)},control:{"content-headline-text-mgrid":{selectionchange:"onSelectionChange"},"content-headline-text-mgrid button[action=save]":{click:"onSaveBtnClicked"},"content-headline-text-mgrid button[action=delete]":{click:"onBtnClicked"},"content-headline-text-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"},"content-headline-text-mgrid button[action=content-headline-picture]":{click:"onTextHeadLineBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),d.module,b?b.length:0);0==f&&Ext.log("No selection"),e.down("button[action=save]").setDisabled(f<1),e.down("button[action=delete]").setDisabled(f<1)},onSaveBtnClicked:function(a){var b=this,c=a.up("grid"),d=c.getSelection();if(0!=d.length){var e=d[0].data.id,f=d[0].data.status,g=d[0].data.redStatus,h=d[0].data.cateOrderBy,i=d[0].data.name;b.sendAjaxFromData(a.action,a.text,c,{url:"/cn/article/updateHeadLine?"+a.action+"&id="+e+"&status="+f+"&redStatus="+g+"&cateOrderBy="+h+"&name="+i})}},onBtnClicked:function(a){var b=this,c=a.up("grid"),d=_am.currentUser.account;b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/article/headLineBtn?"+a.action+"&type=1&account="+d})},onTextHeadLineBtnClicked:function(a){var b=this,c=b.getView(),d=c.up().up(),e=d.getController(),f=d.id.split("-"),f=f[f.length-1],g="content-headline-picture-win-"+f;c.up().hide();var h=e.lookupReference(g);h||(h=Ext.create({xtype:"headlinewindow",reference:g,viewModel:{data:{category:f,categoryName:d.getTitle(),subItem:"content-headline-text-mgrid",type:"text"}}}),d.add(h)),h.show()},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.up(),e=c.down("form").getForm(),f=c.query("[name=id]")[0].value,g=_am.currentUser.id;b.formSubmit(e,{url:"/cn/article/createHeadLine?id="+f+"&type=1&userId="+g},function(a,b){Ext.ux.Msg.info("保存成功",function(){c.hide();var a=d.down("grid");a.getStore().reload(),a.getSelectionModel().deselectAll()})})}}),Ext.define("Admin.view.content.headline.text.TextMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"content-headline-text-mgrid",requires:[],controller:"content-headline-text",initComponent:function(){var a=this,b=a.getViewModel();Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/article/headLine",extraParams:{category:b.get("category")||"",type:"text"},reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:80},{text:'次序 <span class="admin-color-red">+</span>',dataIndex:"cateOrderBy",editor:{xtype:"numberfield",allowBlank:!1,allowDecimals:!1,minValue:0},width:80},{text:"状态",dataIndex:"status",renderer:a.renderer,width:80,editor:{xtype:"combo",store:[[0,"未发"],[9,"已发"]],editable:!1,triggerAction:"all",forceSelection:!0,allowBlank:!1}},{text:"标题",dataIndex:"name",renderer:a.renderer,flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:"栏目",dataIndex:"category",width:150},{text:'套红 <span class="admin-color-red">+</span>',dataIndex:"redStatus",xtype:"checkcolumn"},{text:"创建人",dataIndex:"creator"},{text:"加入时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"更新时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"},"->",{xtype:"button",text:"栏目文章列表",userCls:"admin-label-button",action:"content-headline-picture"}],plugins:[{ptype:"cellediting",clicksToEdit:1}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:#0066FF","未发";case 9:return b.tdStyle="color:#7DB336","已发";default:return a}case"title":return 1==c.get("redStatus")?'<span class="admin-color-red">'+a+"</span>":a;case"headlinePic":switch(a){case 2:return'<span class="x-fa fa-picture"></span>';case 0:return'<span class="x-fa fa-picture-o"></span>'}default:return a}}}),Ext.define("Admin.view.content.headline.picture.PictureController",{extend:"Admin.controller.ViewController",alias:"controller.content-headline-picture",module:"content-headline-picture",url:"Super Awesome",init:function(){console.log(this)},control:{"content-headline-picture-mgrid":{selectionchange:"onSelectionChange"},"content-headline-picture-mgrid button[action=save]":{click:"onSaveBtnClicked"},"content-headline-picture-mgrid button[action=delete]":{click:"onBtnClicked"},"content-headline-picture-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"},"content-headline-picture-mgrid button[action=content-headline-picture]":{click:"onPictureHeadLineBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.module,b?b.length:0);0==f&&Ext.log("No selection"),e.down("button[action=save]").setDisabled(f<1),e.down("button[action=delete]").setDisabled(f<1)},onSaveBtnClicked:function(a){var b=this,c=a.up("grid"),d=c.getSelection();if(0!=d.length){var e=d[0].data.id,f=d[0].data.status,g=d[0].data.redStatus,h=d[0].data.cateOrderBy,i=d[0].data.name;b.sendAjaxFromData(a.action,a.text,c,{url:"/cn/article/updateHeadLine?"+a.action+"&id="+e+"&status="+f+"&redStatus="+g+"&cateOrderBy="+h+"&name="+i})}},onBtnClicked:function(a){var b=this,c=a.up("grid"),d=_am.currentUser.account;b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/article/headLineBtn?"+a.action+"&type=2&account="+d})},onPictureHeadLineBtnClicked:function(a){var b=this,c=b.getView(),d=c.up().up(),e=d.getController(),f=d.id.split("-"),f=f[f.length-1],g="content-headline-picture-win-"+f;c.up().hide();var h=e.lookupReference(g);h||(h=Ext.create({xtype:"headlinewindow",reference:g,viewModel:{data:{category:f,categoryName:d.getTitle(),subItem:"content-headline-picture-mgrid",type:"picture"}}}),d.add(h)),h.show()},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.up(),e=c.down("form").getForm(),f=c.query("[name=id]")[0].value,g=_am.currentUser.id;b.formSubmit(e,{url:"/cn/article/createHeadLine?id="+f+"&type=2&userId="+g},function(a,b){Ext.ux.Msg.info("保存成功",function(){c.hide();var a=d.down("grid");a.getStore().reload(),a.getSelectionModel().deselectAll()})})}}),Ext.define("Admin.view.content.headline.picture.PictureMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"content-headline-picture-mgrid",requires:[],controller:"content-headline-picture",initComponent:function(){var a=this,b=a.getViewModel();Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/article/headLine",extraParams:{category:b.get("category")||"",type:"pic"},reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:80},{text:'次序 <span class="admin-color-red">+</span>',dataIndex:"cateOrderBy",editor:{xtype:"numberfield",allowBlank:!1,allowDecimals:!1,minValue:0},width:80},{text:"状态",dataIndex:"status",renderer:a.renderer,width:80,editor:{xtype:"combo",store:[[0,"未发"],[9,"已发"]],editable:!1,triggerAction:"all",forceSelection:!0,allowBlank:!1}},{text:"标题",dataIndex:"name",renderer:a.renderer,flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:"栏目",dataIndex:"category",width:150},{text:'套红 <span class="admin-color-red">+</span>',dataIndex:"redStatus",xtype:"checkcolumn"},{text:"创建人",dataIndex:"creator"},{text:"加入时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"更新时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"},"->",{xtype:"button",text:"栏目图片列表",userCls:"admin-label-button",action:"content-headline-text"}],plugins:[{ptype:"cellediting",clicksToEdit:1}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:#0066FF","未发";case 9:return b.tdStyle="color:#7DB336","已发";default:return a}case"title":return 1==c.get("redStatus")?'<span class="admin-color-red">'+a+"</span>":a;default:return a}}}),Ext.define("Admin.view.content.headline.picture.PictureMainForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"content-headline-picture-mform",requires:[],controller:"content-headline-picture",maximized:!0,maximizable:!1,layout:"border",initComponent:function(){var a=this;Ext.apply(a,{items:[{xtype:"panel",region:"center",layout:"form",minHeight:400,border:!1,scrollable:"y",items:[{border:!1,xtype:"form",height:"100%",defaults:{xtype:"fieldcontainer",defaults:{labelWidth:80,labelAlign:"right",width:"50%"}},bodyPadding:10,items:[{layout:{type:"hbox",align:"stretchmax"},items:[{xtype:"displayfield",fieldLabel:"文章标题",reference:"title",publishes:"value",name:"title"},{xtype:"displayfield",fieldLabel:"文章ID",name:"id",width:"30%"}]},{items:[{xtype:"textfield",fieldLabel:"头条标题",name:"topTitle",allowBlank:!1,bind:{value:"{title.value}"}}]},{items:[{xtype:"combobox",reference:"media",publishes:"value",fieldLabel:"选择图片",name:"imageId",displayField:"title",emptyText:"请选择图片",allowBlank:!1,editable:!1,valueField:"id",anchor:"-15",store:{storeId:"media",proxy:{type:"ajax",url:"/cn/article/mediaImgList",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0},queryMode:"local",listConfig:{itemTpl:['<div data-qtip="{title}: {url}">{title} ({url})</div>']},listeners:{select:function(a){var b=a.lastSelectedRecords[0].data.url;a.up().query("[name=image]")[0].getEl().dom.src=b}}},{xtype:"container",height:150,items:{name:"image",autoEl:{tag:"image",src:"resources/images/placeholder.jpg"},height:150,width:300},style:{left:"80px"}}]},{items:[{xtype:"textfield",fieldLabel:"栏目名称",name:"category",allowBlank:!1,width:"50%"}]},{layout:"fit",width:595,style:{left:"85px"},items:[{xtype:"itemselector",name:"categoryName",height:160,scrollable:"y",imagePath:"../ux/images/",buttons:["add","remove"],buttonsText:["增加","删除"],store:{proxy:{type:"ajax",url:"/cn/article/categoryENameList",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0},displayField:"eName",valueField:"id",msgTarget:"side"}]}],tbar:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]}]}]}),a.callParent()}}),Ext.define("Admin.view.content.headline.text.TextMainForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"content-headline-text-mform",requires:[],controller:"content-headline-text",maximized:!0,maximizable:!1,width:1e3,layout:"border",initComponent:function(){var a=this;Ext.apply(a,{items:[{xtype:"panel",region:"center",layout:"form",border:!1,scrollable:"y",items:[{border:!1,xtype:"form",defaults:{xtype:"fieldcontainer",defaults:{labelWidth:80,labelAlign:"right",width:"50%"}},bodyPadding:10,items:[{layout:{type:"hbox",align:"stretchmax"},items:[{xtype:"displayfield",fieldLabel:"文章标题",reference:"title",publishes:"value",name:"title"},{xtype:"displayfield",fieldLabel:"文章ID",name:"id",width:"30%"}]},{layout:{type:"hbox",align:"stretchmax"},items:[{xtype:"textfield",fieldLabel:"头条标题",name:"topTitle",allowBlank:!1,bind:{value:"{title.value}"}},{xtype:"checkboxgroup",fieldLabel:"套红",items:[{name:"redStatus",inputValue:"1"}],width:100}]},{items:[{xtype:"textfield",fieldLabel:"栏目名称",name:"category",allowBlank:!1,width:"50%"}]},{layout:"fit",width:595,style:{left:"85px"},items:[{xtype:"itemselector",name:"categoryName",height:220,scrollable:"y",imagePath:"../ux/images/",buttons:["add","remove"],buttonsText:["增加","删除"],store:{proxy:{type:"ajax",url:"/cn/article/categoryENameList",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0},displayField:"eName",valueField:"id",msgTarget:"side"}]}],tbar:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]}]}]}),a.callParent()}}),Ext.define("Admin.view.content.ArticleUpdateController",{extend:"Admin.controller.ViewController",alias:"controller.main-panel-article",control:{"main-panel-article button[action=update]":{click:"onUpdateBtnClicked"},"main-panel-article button[action=cancel]":{click:"onCancelBtnClicked"},"main-panel-article button[action=save]":{click:"onSaveBtnClicked"}},onUpdateBtnClicked:function(a){var b=a.up().up(),c=b.query('[itemId^="d-"]'),d=b.query('[itemId^="v-"]'),e=b.down("button[action=cancel]"),f=b.down("button[action=save]"),g=b.down("button[action=update]");Ext.each(c,function(a,b,c){a.setHidden(!0)}),Ext.each(d,function(a,b,c){a.setHidden(!1)}),e.setHidden(!1),f.setHidden(!1),g.setHidden(!0);var h=b.up().down("main-panel-article");h.setHeight(h.getHeight())},onCancelBtnClicked:function(a){var b=a.up().up(),c=b.query('[itemId^="d-"]'),d=b.query('[itemId^="v-"]'),e=b.down("button[action=cancel]"),f=b.down("button[action=save]");Ext.each(c,function(a,b,c){a.setHidden(!1)}),Ext.each(d,function(a,b,c){a.setHidden(!0)}),e.setHidden(!0),f.setHidden(!0);var g=b.up().down("main-panel-article");g.setHeight(g.getHeight())},onSaveBtnClicked:function(a){var b=a.up().up(),c=b.query("[name=id]")[0].value;c=c.split("：")[1];var d=b.query("[name=title]")[0].value,e=b.query("[name=author]")[0].value,f=b.query("[name=depict]")[0].value,g=b.query("[name=kId]")[0].value,h=editor.html(),i=_am.currentUser.account;Ext.Ajax.request({method:"POST",url:"/cn/article/updateArticle",params:{id:c,title:d,author:e,depict:f,kIds:g,content:h,account:i},waitMsg:"正在修改中，请稍候...",success:function(b){var c=b.responseText;c=JSON.parse(c),c.success?Ext.ux.Msg.info("文章已修改",function(){}):Ext.ux.Msg.info("文章修改异常，请稍后再试...",function(){});var d=a.up().up(),e=a.up().up().up().down("content-mgrid");e.getStore().reload(),e.getSelectionModel().deselectAll();var f=d.down("button[action=cancel]"),g=d.down("button[action=save]");f.setHidden(!0),g.setHidden(!0)}})}}),Ext.define("Admin.view.content.ArticleUpdatePanel",{extend:"Ext.panel.Panel",xtype:"main-panel-article",margin:5,requires:[],controller:"main-panel-article",layout:{type:"table",columns:5,tableAttrs:{style:{width:"100%"}}},scrollable:!0,defaults:{bodyPadding:"8 10",border:!1},viewModel:{data:{article:null}},initComponent:function(){var a=this;Ext.apply(a,{xtype:"form",defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side"},bodyPadding:10,items:[{xtype:"displayfield",itemId:"d-title",bind:"<strong>文章标题：</strong>{article.title}"},{xtype:"fieldcontainer",fieldLabel:"<strong>文章标题</strong>",hidden:!0,style:"position: absolute;top: 10px;left: -33px;",itemId:"v-title",combineErrors:!0,defaultType:"textfield",items:{name:"title",bind:"{article.title}",allowBlank:!1,width:300}},{xtype:"displayfield",name:"id",bind:"<strong>文章ID</strong>：{article.id}"},{xtype:"displayfield",value:"",itemId:"d-keyWord",colspan:3,listeners:{beforerender:function(a){var b,c=a.up().getViewModel().data.article.data.id;Ext.Ajax.request({method:"POST",url:"/cn/article/getArticleKeyWord?aId="+c}).then(function(c){var d=c.responseText,e=JSON.parse(d);b=e.rows;for(var f=new Array,g=new Array,h=0;h<b.length;h++)g=[b[h].name],f[h]=g;b=f,a.setValue("<strong>标签：</strong>"+b)})}}},{xtype:"fieldcontainer",fieldLabel:"<strong>标签</strong>",colspan:3,itemId:"v-keyWord",layout:"hbox",hidden:!0,publishes:"value",combineErrors:!0,defaultType:"textfield",style:"position: absolute;top: 10px;left: 49.5%;",items:[{xtype:"tagfield",name:"kId",bind:"{article.kId}",store:{proxy:{type:"ajax",url:"/cn/article/getKeyWord",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0},displayField:"name",valueField:"id",queryMode:"local",createNewOnEnter:!0,createNewOnBlur:!0,filterPickList:!0,allowBlank:!1,width:350}]},{xtype:"displayfield",bind:'<strong>发布路径：</strong><a href="{article.url}" target="_blank">{article.url}</a>'},{xtype:"displayfield",itemId:"d-author",bind:"<strong>作者：</strong>{article.author}"},{xtype:"fieldcontainer",fieldLabel:"<strong>作者</strong>",hidden:!0,style:"position: absolute;left: 32.7%;top: 45px;",itemId:"v-author",combineErrors:!0,defaultType:"textfield",items:{name:"author",bind:"{article.author}",allowBlank:!1,width:150}},{xtype:"displayfield",bind:"<strong>录入人：</strong>{article.creator}",colspan:3},{xtype:"displayfield",value:"<strong>简介：</strong>",colspan:5},{xtype:"displayfield",bind:"{article.depict}",itemId:"d-depict",colspan:5},{xtype:"textarea",bind:"{article.depict}",itemId:"v-depict",name:"depict",colspan:5,hidden:!0,width:"100%"},{xtype:"displayfield",value:"",listeners:{beforerender:function(a){var b=a.up().getViewModel().data.article.data.status,c="";switch(b){case 0:c='<span style="color:#0066FF">初稿</span>';break;case 1:c='<span style="color: black">已签</span>';break;case 5:c='<span style="color:#FF6633">返工</span>';break;case 9:c='<span style="color:#7DB336">已发</span>';break;default:c='<span style="color:red">异常</span>'}a.setValue("<strong>状态：</strong>"+c)}}},{xtype:"displayfield",bind:"<strong>创建于：</strong>{article.createDate}"},{xtype:"displayfield",bind:"<strong>最后更新于：</strong>{article.updateDate}"},{xtype:"displayfield",bind:"<strong>发布于：</strong>{article.publishDate}"},{xtype:"displayfield",value:"",listeners:{beforerender:function(a){var b=a.up().getViewModel().data.article.data.sId;if(0==b)return void a.setValue("<strong>连载：</strong>未连载");Ext.Ajax.request({method:"POST",url:"/cn/serial/serialQueryForId?id="+b}).then(function(b,c){var d=Ext.decode(b.responseText);a.setValue("<strong>连载：</strong>"+d.rows.name)})}}},{html:"<hr />",border:!1,colspan:5},{xtype:"displayfield",bind:"{article.content}",itemId:"d-content",colspan:5},{width:"100%",height:480,colspan:5,border:0,itemId:"v-content",hidden:!0,name:"content",xtype:"panel",html:'<textarea id="content" style="width: 100%; height: 350px;"></textarea><script>document.getElementById("#content-area").val("")<\/script>',listeners:{afterrender:function(a,b){var c=a.up().getViewModel().data.article.data.content;editor=KindEditor.create("#content",{resizeType:1,allowPreviewEmoticons:!1,items:["fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","removeformat","|","justifyleft","justifycenter","justifyright","insertorderedlist","insertunorderedlist","|","table","emoticons","image","link","|","quickformat","pagebreak","fullscreen"],allowFileUpload:!1,uploadJson:"/cn/admin/mediaCreate",fillDescAfterUploadImage:!0,formatUploadUrl:!1,extraFileUploadParams:{type:1,rule:0}}),editor.html(c)}}}],tbar:["->",{xtype:"button",text:"取消",hidden:!0,iconCls:"x-fa fa-undo",action:"cancel"},{xtype:"button",text:"保存",hidden:!0,iconCls:"x-fa fa-floppy-o",action:"save"},{xtype:"button",text:"修改",iconCls:"x-fa fa-recycle",action:"update"}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:#0066FF","状态：初稿";case 1:return b.tdStyle="color:blank","状态：已签";case 5:return b.tdStyle="color:#FF6633","状态：返工";case 9:return b.tdStyle="color:#7DB336","状态：已发";default:return b.tdStyle="color:red",a}case"hAId":return 0==a?'<button class="x-fa fa-flag admin-label-button admin-color-purple" action="set-text-headline"></button>':'<button class="x-fa fa-flag admin-label-button admin-color-gray" action="cancel-text-headline"></button>';case"hPId":return 0==a?'<button class="x-fa fa-picture-o admin-label-button admin-color-purple" action="set-picture-headline"></button>':'<button class="x-fa fa-picture-o admin-label-button admin-color-gray" action="cancel-picture-headline"></button>';default:return a}}}),Ext.define("Admin.view.content.Content",{extend:"Ext.panel.Panel",xtype:"content",requires:[],uses:[],controller:"content",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"north",xtype:"content-sp"},{region:"center",xtype:"content-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.content.recycle.RecycleController",{extend:"Admin.controller.ViewController",alias:"controller.content-recycle",module:"content-recycle",url:"Super Awesome",init:function(){console.log(this)},control:{"content-recycle-sp button[action=search]":{click:"onSearchPanelQuery"},"content-recycle-sp button[action=reset]":{click:"onSearchPanelReset"},"content-recycle-mgrid":{selectionchange:"onSelectionChange"},"content-recycle-mgrid button[action=restore]":{click:"onBtnClicked"},"content-recycle-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),d.module),g=e.down(f+d.getSearchGridSuffix()),h=d.lookupReference("status"),i=b?b.length:0;0==i&&(Ext.log("No selection"),h.update("")),h.update("已选中<strong>"+i+"</strong>篇文章！"),g.down("button[action=restore]").setDisabled(i<1)},onBtnClicked:function(a){for(var b=this,c=a.up("grid"),d=c.getSelection(),e=new Array,f=0;f<d.length;f++)e[f]=d[f].id,b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/article/articleButton",method:"POST",params:{type:a.action,ids:e},waitMsg:"正在修改中，请等待片刻...",submitEmptyText:!1,success:function(a,b){JSON.parse(a.responseText).success?Ext.MessageBox.show({title:"操作提示",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,align:"center",message:"操作成功"}):Ext.MessageBox.show({title:"操作提示",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR,align:"center",message:"操作异常，请稍后再试..."});var d=c.getStore();d.getProxy().setExtraParam("page",1),d.reload()}})}}),Ext.define("Admin.view.content.recycle.RecycleSearchPanel",{extend:"Admin.view.common.panel.BaseSearchPanel",xtype:"content-recycle-sp",initComponent:function(){var a=this,b=a.subDefaults;Ext.apply(a,{items:[{defaults:b,items:[{xtype:"textfield",fieldLabel:"文章标题",emptyText:"",itemId:"search-title"},{xtype:"datefield",fieldLabel:"开始日期",itemId:"search-startdate",vtype:"daterange",endDateField:"search-enddate",editable:!1,format:"Y-m-d",submitFormat:"Y-m-d"},{xtype:"datefield",fieldLabel:"结束日期",itemId:"search-enddate",vtype:"daterange",editable:!1,startDateField:"search-startdate",format:"Y-m-d",submitFormat:"Y-m-d"},{xtype:"button",text:"查询",iconCls:"x-fa fa-search",action:"search"},{xtype:"button",text:"重置",iconCls:"x-fa fa-undo",action:"reset"}]}]}),a.callParent()}}),Ext.define("Admin.view.content.recycle.RecycleMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"content-recycle-mgrid",initComponent:function(){var a=this,b=location.hash.split("-"),b=b[b.length-1];Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/article/articleList",extraParams:{category:b},reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:80},{text:"状态",dataIndex:"status",renderer:a.renderer,width:80},{text:"标题",dataIndex:"title",renderer:a.renderer,flex:1},{text:"栏目",dataIndex:"category",width:150},{text:"作者",dataIndex:"author"},{text:"创建人",dataIndex:"creator"},{text:"头条",dataIndex:"headlineArticle",renderer:a.renderer},{text:"图片",dataIndex:"headlinePic",renderer:a.renderer},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"更新时间",dataIndex:"lastChange",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"还原",iconCls:"x-fa fa-undo",disabled:!0,action:"restore"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"},"-",{xtype:"component",reference:"status",style:{color:"crimson"}}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 10:return b.tdStyle="color:#0066FF","初稿";case 11:return b.tdStyle="color:blank","已签";case 15:return b.tdStyle="color:#FF6633","返工";case 19:return b.tdStyle="color:#7DB336","已发";case 20:return b.tdStyle="color:red","已删"}case"headlineArticle":switch(a){case 1:return'<button class="x-fa fa-flag admin-label-button admin-color-purple" action="set-text-headline"></button>';case 0:return'<button class="x-fa fa-flag admin-label-button admin-color-gray" action="cancel-text-headline"></button>'}case"headlinePic":switch(a){case 2:return'<button class="x-fa fa-picture-o admin-label-button admin-color-purple" action="set-picture-headline"></button>';case 0:return'<button class="x-fa fa-picture-o admin-label-button admin-color-gray" action="cancel-picture-headline"></button>'}case"title":default:return a}}}),Ext.define("Admin.view.content.recycle.Recycle",{extend:"Ext.panel.Panel",xtype:"content-recycle",requires:[],controller:"content-recycle",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"north",xtype:"content-recycle-sp"},{region:"center",xtype:"content-recycle-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.content.index.embed.FutianController",{extend:"Admin.controller.ViewController",alias:"controller.content-index-embed-futian",module:"content-index-embed-futian",control:{"content-index-embed-futian button[action=edit]":{click:"onClickedEdit"},"content-index-embed-futian button[action=release]":{click:"onClickedRelease"},"content-index-embed-futian button[action=refresh]":{click:"onClickedRefresh"}},onClickedRelease:function(){Ext.Ajax.request({method:"POST",url:"/cn/article/create/embed",success:function(a){var b=a.responseText;b=JSON.parse(b),b.success?Ext.ux.Msg.info("发布成功",function(){}):Ext.ux.Msg.info("发布失败",function(){})}})},onClickedRefresh:function(a){a.up().up().down("grid").getStore().reload()},onClickedEdit:function(a){var b=a.up().up().down("grid"),c=a.up().up().down("form"),d=c.query("[name=depict]")[0].value,e=b.getSelection();0==e.length&&(e=b.setSelection(1,!0).getSelection());var f=e[0].data;f.depict=d,Ext.Ajax.request({url:"/cn/article/updateFutian",method:"POST",waitMsg:"正在修改中，请等待片刻...",params:{depict:f.depict.trim(),use:f.use,bank:f.bank,user:f.user,card:f.card},success:function(a,c){console.log(a),Ext.decode(a.responseText).success&&Ext.MessageBox.show({title:"操作提示",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,align:"center",message:"修改成功",fn:function(a){b.getStore().reload()}})}})}}),Ext.define("Admin.view.content.index.embed.FutianGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"content-index-embed-futian-mgrid",selModel:{selType:"cellmodel"},plugins:{ptype:"cellediting",clicksToEdit:1},initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/cn/article/articleForId?id=3"},autoLoad:!0}),columns:[{text:"用途",dataIndex:"use",align:"center",flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:"开户行",dataIndex:"bank",align:"center",flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:"户名",dataIndex:"user",align:"center",flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:"帐号",dataIndex:"card",align:"center",flex:1,editor:{xtype:"textfield",allowBlank:!1}}],bbar:""}),a.callParent()}}),Ext.define("Admin.view.content.index.embed.FutianForm",{extend:"Admin.view.common.panel.BaseSearchPanel",xtype:"content-index-embed-futian-mform",controller:"content-index-embed-futian",bodyPadding:"0px",margin:"0 0 0 0",initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",borderStyle:"none",defaults:{anchor:"100% 100%"},width:"100%",items:[{xtype:"textarea",name:"depict",listeners:{beforerender:function(a){Ext.Ajax.request({url:"/cn/article/articleForId?id=3"}).then(function(b,c){
var d=Ext.decode(b.responseText);a.setValue("\n"+d.depict)})}}}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.content.index.embed.Futian",{extend:"Ext.panel.Panel",xtype:"content-index-embed-futian",requires:[],controller:"content-index-embed-futian",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"north",xtype:"content-index-embed-futian-mform"},{region:"center",xtype:"content-index-embed-futian-mgrid"}],tbar:[{xtype:"button",text:"保存",iconCls:"x-fa fa-pencil-square-o",action:"edit"},{xtype:"button",text:"发布",iconCls:"x-fa fa-paper-plane-o",action:"release"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}]}),a.callParent()}}),Ext.define("Admin.view.content.index.embed.ContactGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"content-index-embed-contact-mgrid",selModel:{selType:"cellmodel"},plugins:{ptype:"cellediting",clicksToEdit:1},initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/cn/article/articleForId?id=4",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",hidden:!0},{text:"key",dataIndex:"key",width:250,editor:{xtype:"textfield",allowBlank:!1}},{text:"value",dataIndex:"value",flex:1,editor:{xtype:"textfield",allowBlank:!1}}],bbar:""}),a.callParent()}}),Ext.define("Admin.view.content.index.embed.ContactController",{extend:"Admin.controller.ViewController",alias:"controller.content-index-embed-contact",control:{"content-index-embed-contact button[action=edit]":{click:"onClickedEdit"},"content-index-embed-contact button[action=release]":{click:"onClickedRelease"},"content-index-embed-contact button[action=refresh]":{click:"onClickedRefresh"}},onClickedRelease:function(){Ext.Ajax.request({method:"POST",url:"/cn/article/create/embed",success:function(a){var b=a.responseText;b=JSON.parse(b),b.success?Ext.ux.Msg.info("发布成功",function(){}):Ext.ux.Msg.info("发布失败",function(){})}})},onClickedEdit:function(a){var b=a.up().up().down("grid"),c=b.getSelection();if(0!=c.length){var d=c[0].data;Ext.Ajax.request({url:"/cn/article/updateContact",method:"POST",waitMsg:"正在修改中，请等待片刻...",params:{contactId:d.id,contactKey:d.key,contactValue:d.value},success:function(a,c){Ext.decode(a.responseText).success&&Ext.MessageBox.show({title:"操作提示",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,align:"center",message:"修改成功",fn:function(a){b.getStore().reload()}})}})}},onClickedRefresh:function(a){a.up().up().down("grid").getStore().reload()}}),Ext.define("Admin.view.content.index.embed.Contact",{extend:"Ext.panel.Panel",xtype:"content-index-embed-contact",requires:[],controller:"content-index-embed-contact",initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"content-index-embed-contact-mgrid"}],tbar:[{xtype:"button",text:"保存",iconCls:"x-fa fa-pencil-square-o",action:"edit"},{xtype:"button",text:"发布",iconCls:"x-fa fa-paper-plane-o",action:"release"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}]}),a.callParent()}}),Ext.define("Admin.view.content.index.embed.FocusController",{extend:"Admin.controller.ViewController",alias:"controller.content-index-embed-focus",module:"content-index-embed-focus",url:"Super Awesome",init:function(){},control:{"content-headline-focus-mgrid":{selectionchange:"onSelectionChange"},"content-headline-focus-mgrid button[action=save]":{click:"onSaveBtnClicked"},"content-headline-focus-mgrid button[action=delete]":{click:"onBtnClicked"},"content-headline-focus-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.module,b?b.length:0);0==f&&Ext.log("No selection"),e.down("button[action=save]").setDisabled(f<1),e.down("button[action=delete]").setDisabled(f<1)},onSaveBtnClicked:function(a){var b=this,c=a.up("grid"),d=c.getSelection();if(0!=d.length){var e=d[0].data.id,f=d[0].data.status,g=d[0].data.redStatus,h=d[0].data.cateOrderBy,i=d[0].data.name;b.sendAjaxFromData(a.action,a.text,c,{url:"/cn/article/updateHeadLine?"+a.action+"&id="+e+"&status="+f+"&redStatus="+g+"&cateOrderBy="+h+"&name="+i})}},onBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/article/headLineBtn?"+a.action+"&type=1"})},onTextHeadLineBtnClicked:function(a){var b=this,c=b.getView(),d=c.up().up(),e=d.getController(),f=d.id.split("-"),f=f[f.length-1],g="content-headline-picture-win-"+f;c.up().hide();var h=e.lookupReference(g);h||(h=Ext.create({xtype:"headlinewindow",reference:g,viewModel:{data:{category:f,categoryName:d.getTitle(),subItem:"content-headline-text-mgrid",type:"text"}}}),d.add(h)),h.show()},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.up(),e=c.down("form").getForm(),f=c.query("[name=id]")[0].value,g=_am.currentUser.id;b.formSubmit(e,{url:"/cn/article/createHeadLine?id="+f+"&type=1&userId="+g},function(a,b){Ext.ux.Msg.info("保存成功",function(){c.hide();var a=d.down("grid");a.getStore().reload(),a.getSelectionModel().deselectAll()})})}}),Ext.define("Admin.view.content.index.embed.FocusGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"content-headline-focus-mgrid",requires:[],controller:"content-index-embed-focus",initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/article/headLine",extraParams:{category:"focus",type:"pic"},reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:80},{text:'次序 <span class="admin-color-red">+</span>',dataIndex:"cateOrderBy",editor:{xtype:"numberfield",allowBlank:!1,allowDecimals:!1,minValue:0},width:80},{text:"状态",dataIndex:"status",renderer:a.renderer,width:80,editor:{xtype:"combo",store:[[0,"未发"],[9,"已发"]],editable:!1,triggerAction:"all",forceSelection:!0,allowBlank:!1}},{text:"标题",dataIndex:"name",renderer:a.renderer,flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:"栏目",dataIndex:"category",width:150},{text:'套红 <span class="admin-color-red">+</span>',dataIndex:"redStatus",xtype:"checkcolumn"},{text:"创建人",dataIndex:"creator"},{text:"加入时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"更新时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],plugins:[{ptype:"cellediting",clicksToEdit:1}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:#0066FF","未发";case 9:return b.tdStyle="color:#7DB336","已发";default:return a}case"title":return 1==c.get("redStatus")?'<span class="admin-color-red">'+a+"</span>":a;case"headlinePic":switch(a){case 2:return'<span class="x-fa fa-picture"></span>';case 0:return'<span class="x-fa fa-picture-o"></span>'}default:return a}}}),Ext.define("Admin.view.content.index.embed.Focus",{extend:"Ext.panel.Panel",xtype:"content-index-embed-focus",requires:[],controller:"content-index-embed-focus",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"content-headline-focus-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.content.index.embed.FawuController",{extend:"Admin.controller.ViewController",alias:"controller.content-index-embed-fawu",control:{"content-index-embed-fawu button[action=update]":{click:"onUpdateBtnClicked"},"content-index-embed-fawu button[action=cancel]":{click:"onCancelBtnClicked"},"content-index-embed-fawu button[action=save]":{click:"onSaveBtnClicked"},"content-index-embed-fawu button[action=release]":{click:"onReleaseBtnClicked"}},onSaveBtnClicked:function(a){var b=a.up().up(),c=b.query("[itemId^=d-]"),d=b.query("[itemId^=v-]"),e=b.down("[action=cancel]"),f=b.down("[action=save]"),g=b.down("[action=update]"),h=location.hash.split("-"),h=h[h.length-1];switch(h){case"short":h=5;break;case"temple":h=6;break;case"buddha":h=7}var i=b.query("[name=content]")[1].value;Ext.Ajax.request({method:"POST",url:"/cn/article/updateEmbedForId",params:{id:h,content:i},success:function(a){var b=a.responseText;b=JSON.parse(b),b.success?Ext.ux.Msg.info("修改成功",function(){}):Ext.ux.Msg.error("修改失败",function(){})}}),Ext.each(c,function(a,b,c){a.setHidden(!1)}),Ext.each(d,function(a,b,c){a.setHidden(!0)}),b.query("[name=content]")[0].setValue(i),e.setHidden(!0),f.setHidden(!0),g.setHidden(!1)},onUpdateBtnClicked:function(a){var b=a.up().up(),c=b.query("[itemId^=d-]"),d=b.query("[itemId^=v-]"),e=b.down("[action=cancel]"),f=b.down("[action=save]"),g=b.down("[action=update]"),h=b.down("[action=release]");Ext.each(c,function(a,b,c){a.setHidden(!0)}),Ext.each(d,function(a,b,c){a.setHidden(!1)}),e.setHidden(!1),f.setHidden(!1),g.setHidden(!0),h.setDisabled(!0)},onCancelBtnClicked:function(a){var b=a.up().up(),c=b.query("[itemId^=d-]"),d=b.query("[itemId^=v-]"),e=b.down("[action=cancel]"),f=b.down("[action=save]"),g=b.down("[action=update]"),h=b.down("[action=release]");Ext.each(c,function(a,b,c){a.setHidden(!1)}),Ext.each(d,function(a,b,c){a.setHidden(!0)}),e.setHidden(!0),f.setHidden(!0),g.setHidden(!1),h.setDisabled(!1)},onReleaseBtnClicked:function(a){console.log(a.action);var b=location.hash.split("-"),b=b[b.length-1];switch(b){case"short":b=5;break;case"temple":b=6;break;case"buddha":b=7}var c=[b];Ext.Ajax.request({method:"POST",url:"/cn/article/articleButton",params:{type:"release",ids:c},success:function(a){var b=a.responseText;b=JSON.parse(b),b.success?Ext.ux.Msg.info("发布成功",function(){}):Ext.ux.Msg.error("发布失败",function(){})}})}}),Ext.define("Admin.view.content.index.embed.Fawu",{extend:"Ext.panel.Panel",xtype:"content-index-embed-fawu",requires:[],controller:"content-index-embed-fawu",scrollable:!0,defaults:{bodyPadding:"8 10",border:!1},initComponent:function(){var a=this,b=location.hash.split("-"),b=b[b.length-1];switch(b){case"short":b=5;break;case"temple":b=6;break;case"buddha":b=7}Ext.apply(a,{xtype:"form",defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side"},bodyPadding:10,items:[{xtype:"displayfield",itemId:"d-content",name:"content",listeners:{beforerender:function(a){Ext.Ajax.request({url:"/cn/article/articleEmbedForId?id="+b}).then(function(b,c){var d=Ext.decode(b.responseText);a.setValue("\n"+d.content)})}}},{xtype:"textarea",itemId:"v-content",name:"content",hidden:!0,width:"100%",height:260,listeners:{beforerender:function(a){Ext.Ajax.request({url:"/cn/article/articleEmbedForId?id="+b}).then(function(b,c){var d=Ext.decode(b.responseText);a.setValue(d.content)})}}}],tbar:[{xtype:"button",text:"取消",hidden:!0,iconCls:"x-fa fa-undo",action:"cancel"},{xtype:"button",text:"保存",hidden:!0,iconCls:"x-fa fa-floppy-o",action:"save"},{xtype:"button",text:"修改",iconCls:"x-fa fa-recycle",action:"update"},{xtype:"button",text:"发布",iconCls:"x-fa fa-paper-plane-o",action:"release"}]}),a.callParent()}}),Ext.define("Admin.view.publish.PublishGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"publish-mgrid",initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/article/publishList",remoteSort:!0,reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:50},{text:"发布人",dataIndex:"user",flex:1},{text:"发布栏目",dataIndex:"category",flex:1},{text:"请求时间",dataIndex:"requestDate",xtype:"datecolumn",align:"center",format:"y-m-d H:i:s",flex:1},{text:"发布状态",dataIndex:"status",flex:1,align:"center",renderer:a.readerer},{text:"完成时间",dataIndex:"finishDate",xtype:"datecolumn",align:"center",format:"y-m-d H:i:s",flex:1}],tbar:[{xtype:"button",text:"发布",iconCls:"x-fa fa-paper-plane-o",action:"publish"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"},"-",{xtype:"button",text:"查看首页",iconCls:"x-fa fa-eye",action:"redirect"}]}),a.callParent()},readerer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:red","失败";case 1:return b.tdStyle="color:green","成功"}default:return a}}}),Ext.define("Admin.view.publish.publishController",{extend:"Admin.controller.ViewController",alias:"controller.publish",control:{"publish-mgrid button[action=publish]":{click:"onClickBtnPublish"},"publish-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"},"publish-mgrid button[action=redirect]":{click:"onRedirectBtnClicked"}},onRedirectBtnClicked:function(){window.open("../../article/index.html")}}),Ext.define("Admin.view.publish.Publish",{extend:"Ext.panel.Panel",xtype:"publish",requires:[],controller:"publish",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"publish-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.serial.SerialGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"serial-mgrid",plugins:{ptype:"cellediting",clicksToEdit:1},initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/serial/serialList",reader:{type:"json",rootProperty:"rows"},remoteSort:!0},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:50},{text:"连载名称",dataIndex:"name",width:150,editor:{xtype:"textfield",allowBlank:!1}},{text:"描述",dataIndex:"depict",flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:"目录模版",dataIndex:"fileName",width:130},{text:"状态",dataIndex:"status",width:100,align:"center",editor:{xtype:"combo",store:[[0,"断更"],[5,"连载中"],[9,"已完结"]],editable:!1,triggerAction:"all",forceSelection:!0,allowBlank:!1},renderer:a.readerer},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",align:"center",format:"y-m-d H:i:s",width:130},{text:"修改时间",dataIndex:"updateDate",xtype:"datecolumn",align:"center",format:"y-m-d H:i:s",width:130},{text:"操作",dataIndex:"url",renderer:a.readerer,flex:1}],tbar:[{xtype:"button",text:"新增",iconCls:"x-fa fa-plus-circle",action:"add"},{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},{xtype:"button",text:"删除",disabled:!0,iconCls:"x-fa fa-trash-o",action:"remove"},"-",{xtype:"button",iconCls:"x-fa fa-refresh",action:"refresh"}]}),a.callParent()},readerer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:red","断更";case 5:return b.tdStyle="color:black","连载中";case 9:return b.tdStyle="color:#0095F8","已完结"}case"url":return b.tdStyle="text-decoration-line: none;",'<a href="'+a+'" target="_blank">'+a+"</a>";default:return a}}}),Ext.define("Admin.view.serial.SerialController",{extend:"Admin.controller.ViewController",alias:"controller.serial",control:{"serial-mgrid":{selectionchange:"onSelectionChange"},"serial-mgrid button[action=add]":{click:"onAddBtnClicked"},"serial-mgrid button[action=save]":{click:"onBtnClicked"},"serial-mgrid button[action=remove]":{click:"onRemoveBtnClicked"},"serial-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),e.down("serial-mgrid")),g=b?b.length:0;0==g&&Ext.log("No selection"),f.down("button[action=save]").setDisabled(1!=g),f.down("button[action=remove]").setDisabled(g<1)},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("serial-mform");d||(d=Ext.create({reference:"serial-mform",xtype:"serial-mform"}),c.add(d)),d.setTitle("新增"),d.show()},onRemoveBtnClicked:function(a){var b=this,c=a.up("grid"),d=_am.currentUser.account;b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/serial/serialBtn?"+a.action+"&account="+d})},onBtnClicked:function(a){var b=this,c=a.up("grid"),d=_am.currentUser.account;b.sendAjaxFromData(a.action,a.text,c,{url:"/cn/serial/serialBtn?"+a.action+"&account="+d})},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();d.isValid()&&d.submit({url:"/cn/serial/createSerial",method:"POST",waitMsg:"正在提交中，请等待片刻...",submitEmptyText:!1,success:function(a,b){b.result.success&&(c.hide(),Ext.MessageBox.show({title:"操作提示",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,message:"连载新增成功",fn:function(){var a=c.up().down("serial-mgrid").getStore();a.getProxy().setExtraParam("page",1),a.reload(),d.reset()}}))}})}}),Ext.define("Admin.view.serial.SerialForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"serial-mform",controller:"serial",width:520,initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",bodyPadding:10,defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{fieldLabel:"id",name:"id",hidden:!0},{name:"name",fieldLabel:"连载名称",allowBlank:!1},{xtype:"textarea",fieldLabel:"连载描述",name:"depict",allowBlank:!1},{xtype:"combobox",fieldLabel:"目录模版",name:"tId",store:{proxy:{type:"ajax",url:"/cn/article/templateListForId?type=2",reader:{type:"json",rootProperty:"rows"}}},displayField:"name",valueField:"id",queryMode:"remote",editable:!1,triggerAction:"all",forceSelection:!0,emptyText:"请选择",allowBlank:!1}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.serial.Serial",{extend:"Ext.panel.Panel",xtype:"serial",requires:[],controller:"serial",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"serial-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.category.CategoryController",{extend:"Admin.controller.ViewController",alias:"controller.category",module:"category",url:"Super Awesome",init:function(){console.log(this)},control:{"category-mgrid":{selectionchange:"onSelectionChange",itemclick:"onItemClick"},"category-mgrid button[action=add]":{click:"onAddBtnClicked"},"category-mgrid button[action=save]":{click:"onSaveBtnClicked"},"category-mgrid button[action=delete]":{click:"onBtnClicked"},"category-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),d.module),g=e.down(f+d.getSearchGridSuffix()),h=b?b.length:0;0==h&&Ext.log("No selection"),g.down("button[action=save]").setDisabled(h<1),g.down("button[action=delete]").setDisabled(h<1)},onItemClick:function(a,b,c,d,e,f){var g=this,h=g.getView(),i=e.target;if(i){var j=i.getAttribute("action"),k=b.get("id");switch(j){case"preview":alert("【"+k+"】"+i.getAttribute("title"));break;case"add":var l=g.lookupReference("category-mform");l||(l=Ext.create({reference:"category-mform",xtype:"category-mform"}),h.add(l)),l.setTitle("新增子栏目"),l.show();var m=l.down("form").getForm();m.findField("parentId").setValue(k),m.findField("parentPath").setValue(b.get("name")).setHidden(!1);break;case"headlineText":case"picture":case"article":alert("【"+k+"】"+i.getAttribute("title"))}}},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("category-mform");d||(d=Ext.create({reference:"category-mform",xtype:"category-mform"}),c.add(d)),d.setTitle("新增"),d.show();var e=d.down("form").getForm();e.findField("parentId").setValue(""),e.findField("parentPath").setValue("").setHidden(!0)},onSaveBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromData(a.action,a.text,c,{url:"data/ajax.json?"+a.action})},onBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"data/ajax.json?"+a.action})},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();b.formSubmit(d,{url:"data/ajax.json"},function(a,b){Ext.ux.Msg.info("保存成功",function(){c.hide();var a=c.up().down("category-mgrid"),b=a.getStore();b.getProxy().setExtraParam("page",1),b.reload(),a.getSelectionModel().deselectAll()})})}}),Ext.define("Admin.view.category.CategoryMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"category-mgrid",actions:{preview:{iconCls:"x-fa fa-file-excel-o",tooltip:"预览",handler:"onDownloadFileBtnClick"},add:{iconCls:"x-fa fa-file-excel-o",tooltip:"新增子栏目",handler:"onDownloadFileBtnClick"},article:{iconCls:"x-fa fa-building",tooltip:"文章列表",handler:"onCreateOrderBtnClicked"},headline:{iconCls:"x-fa fa-search-plus",tooltip:"头条列表",handler:"onSearchOrderBtnClicked"},picture:{iconCls:"x-fa fa-calendar",tooltip:"图片列表",handler:"onAdInfoBtnClicked"}},initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/article/categoryList",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"栏目ID",dataIndex:"id",width:80},{text:'栏目名称 <span class="admin-color-red">+</span>',dataIndex:"eName",width:150,editor:{xtype:"textfield",allowBlank:!1}},{text:"栏目路径",dataIndex:"path",width:150},{text:'存放路径 <span class="admin-color-red">+</span>',dataIndex:"name",width:150},{text:"栏目模板",dataIndex:"category_template",width:150},{text:"文章模板",dataIndex:"article_template",width:150},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"更新时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"新增",iconCls:"x-fa fa-plus-circle",action:"add"},{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],plugins:[{ptype:"cellediting",clicksToEdit:2}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"id":return'<button class="admin-label-button" action="preview" title="预览栏目">预览</button><button class="admin-label-button" action="add" title="新增子栏目">新增</button><button class="admin-label-button" action="article" title="文章列表">文章</button><button class="admin-label-button" action="headlineText" title="栏目头条列表">头条</button><button class="admin-label-button" action="picture" title="栏目图片列表">图片</button>';default:return a}}}),Ext.define("Admin.view.category.CategoryMainForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"category-mform",controller:"category",width:520,initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",bodyPadding:10,defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{fieldLabel:"categoryId",hidden:!0},{fieldLabel:"parentId",name:"parentId",hidden:!0},{xtype:"displayfield",name:"parentPath",fieldLabel:"父路径",hidden:!0},{name:"name",fieldLabel:"目录名称",allowBlank:!1},{name:"ename",fieldLabel:"路径英文",allowBlank:!1},{xtype:"textarea",name:"desc",beforeLabelTextTpl:"",fieldLabel:"目录描述"},{xtype:"textarea",name:"counter",beforeLabelTextTpl:"",fieldLabel:"计数器"}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.category.Category",{extend:"Ext.panel.Panel",xtype:"category",requires:[],uses:[],controller:"category",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"category-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.template.TemplateController",{extend:"Admin.controller.ViewController",alias:"controller.template",module:"template",url:"Super Awesome",init:function(){console.log(this)},control:{"template-mgrid":{selectionchange:"onSelectionChange"},"template-mgrid button[action=add]":{click:"onAddBtnClicked"},"template-mgrid button[action=save]":{click:"onSaveBtnClicked"},"template-mgrid button[action=delete]":{click:"onBtnClicked"},"template-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),d.module);e.down(f+d.getSearchGridSuffix());0==(b?b.length:0)&&Ext.log("No selection")},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("template-mform");d||(d=Ext.create({xtype:"template-mform"}),c.add(d)),d.show()},onSaveBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromData(a.action,a.text,c,{url:"data/ajax.json?"+a.action})},onBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"data/ajax.json?"+a.action})}}),Ext.define("Admin.view.template.TemplateMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"template-mgrid",viewModel:{stores:{templateType:[[1,"文章模板"],[2,"栏目模板"],[3,"区块模板"],[4,"内嵌模板"]]}},initComponent:function(){var a=this;a.getViewModel();Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/article/templateList",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"模板ID",dataIndex:"id",width:100},{text:'名称 <span class="admin-color-red">+</span>',dataIndex:"name",editor:{xtype:"textfield",allowBlank:!1},flex:1},{text:'文件 <span class="admin-color-red">+</span>',dataIndex:"fileName",width:250},{text:'模板类型 <span class="admin-color-red">+</span>',dataIndex:"type",editor:{xtype:"combo",store:[[1,"文章模板"],[2,"栏目模板"],[3,"区块模板"],[4,"内嵌模板"]],editable:!1,triggerAction:"all",forceSelection:!0,allowBlank:!1},renderer:a.renderer,width:250},{text:"状态",dataIndex:"status",editor:{xtype:"combo",store:[[1,"启用"],[-2,"内置"]],editable:!1,triggerAction:"all",forceSelection:!0,allowBlank:!1},renderer:a.renderer},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"修改时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"新增",disabled:!0,iconCls:"x-fa fa-plus-circle",action:"add"},{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],plugins:[{ptype:"cellediting",clicksToEdit:2}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case-2:return b.tdStyle="color:#0066FF","内置";case 1:return b.tdStyle="color:green","启用"}case"type":return g.ownerGrid.getViewModel().getStore("templateType")[a-1][1];default:return a}}}),Ext.define("Admin.view.template.Template",{extend:"Ext.panel.Panel",xtype:"template",requires:[],uses:[],controller:"template",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"template-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.keyword.KeywordController",{extend:"Admin.controller.ViewController",alias:"controller.keyword",module:"keyword",url:"Super Awesome",control:{"keyword-mgrid":{selectionchange:"onSelectionChange"},"keyword-mgrid button[action=add]":{click:"onAddBtnClicked"},"keyword-mgrid button[action=save]":{click:"onSaveBtnClicked"},"keyword-mgrid button[action=delete]":{click:"onBtnClicked"},"keyword-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"},"hotkeyword-grid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),d.module),g=e.down(f+d.getSearchGridSuffix()),h=b?b.length:0;0==h&&Ext.log("No selection"),g.down("button[action=save]").setDisabled(h<1),g.down("button[action=delete]").setDisabled(h<1)},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("keyword-mform");d||(d=Ext.create({xtype:"keyword-mform"}),c.add(d)),d.show()},onSaveBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromData(a.action,a.text,c,{url:"/cn/article/keyWordSave?"+a.action})},onBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/article/keyWordSave?"+a.action})},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();d.isValid()&&d.submit({url:"/cn/article/createKeyWord",method:"POST",waitMsg:"正在提交中，请等待片刻...",submitEmptyText:!1,success:function(a,b){b.result.success&&(c.hide(),Ext.MessageBox.show({title:"操作提示",closable:"true",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,message:"标签创建成功",fn:function(){var a=c.up().down("keyword-mgrid").getStore();a.getProxy().setExtraParam("page",1),a.reload()}}))}})}}),Ext.define("Admin.view.keyword.HotKeywordGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"hotkeyword-grid",iconCls:"x-fa fa-free-code-camp",title:"热门标签",selModel:{selType:""},initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/article/keyWordList",extraParams:{type:"hot"},reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:100},{text:"名称",dataIndex:"name",width:250},{text:"描述",dataIndex:"depict",flex:1},{text:"计数",dataIndex:"count"},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"更新时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],bbar:{xtype:"pagingtoolbar",displayInfo:!0,hidden:!0}}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:#0066FF","内置";case 1:return b.tdStyle="color:green","启用"}case"title":default:return a}}}),Ext.define("Admin.view.keyword.KeywordMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"keyword-mgrid",iconCls:"x-fa fa-list-ul",title:"标签列表",initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Admin.store.API",{proxy:{type:"ajax",url:"/cn/article/keyWordList",extraParams:{type:"list"},reader:{type:"json",rootProperty:"rows"}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:60},{text:'名称 <span class="admin-color-red">+</span>',dataIndex:"name",editor:{xtype:"textfield",allowBlank:!1},width:250},{text:'描述 <span class="admin-color-red">+</span>',dataIndex:"depict",editor:{xtype:"textarea",allowBlank:!1},flex:1},{text:"计数",dataIndex:"count"},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150},{text:"更新时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"新增",iconCls:"x-fa fa-plus-circle",action:"add"},{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],plugins:[{ptype:"cellediting",clicksToEdit:2}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"status":switch(a){case 0:return b.tdStyle="color:#0066FF","内置";case 1:return b.tdStyle="color:green","启用"}case"title":default:return a}}}),Ext.define("Admin.view.keyword.KeyWordForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"keyword-mform",controller:"keyword",initComponent:function(){var a=this,b=Ext.create({xtype:"form",bodyPadding:10,defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{xtype:"fieldcontainer",fieldLabel:"名称",layout:"hbox",combineErrors:!0,defaultType:"textfield",items:{name:"name",allowBlank:!1,emptyText:"",width:"80%"}},{xtype:"fieldcontainer",fieldLabel:"描述",layout:"hbox",combineErrors:!0,defaultType:"textfield",beforeLabelTextTpl:"",items:{name:"depict",emptyText:"",width:"80%"}}],buttons:[{text:"重置",iconCls:"x-fa fa-eye",action:"preview",handler:"onResetBtnClicked"},{text:"提交",
iconCls:"x-fa fa-floppy-o",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.keyword.Keyword",{extend:"Ext.panel.Panel",xtype:"keyword",requires:[],uses:[],controller:"keyword",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",height:"40%",xtype:"hotkeyword-grid"},{region:"south",height:"60%",xtype:"keyword-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.media.MediaController",{extend:"Admin.controller.ViewController",alias:"controller.media",module:"media",url:"Super Awesome",init:function(){console.log(this)},control:{"media-mgrid":{selectionchange:"onSelectionChange",itemclick:"onItemClick"},"media-mgrid button[action=add]":{click:"onAddBtnClicked"},"media-mgrid button[action=save]":{click:"onSaveBtnClicked"},"media-mgrid button[action=delete]":{click:"onDeleteBtnClicked"},"media-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"},"media-mgrid button[action=enabled]":{click:"onEnabledBtnClicked"},"media-mgrid button[action=abandon]":{click:"onAbandonBtnClicked"},"media-mgrid button[action=edit]":{click:"onEditBtnClicked"},"media-sp button[action=search]":{click:"onSearchPanelQuery"},"media-sp button[action=reset]":{click:"onSearchPanelReset"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),d.module),g=e.down(f+d.getSearchGridSuffix()),h=b?b.length:0;0==h&&Ext.log("No selection"),g.down("button[action=save]").setDisabled(h<1),g.down("button[action=delete]").setDisabled(h<1),g.down("button[action=enabled]").setDisabled(h<1),g.down("button[action=abandon]").setDisabled(h<1),g.down("button[action=edit]").setDisabled(h<1)},onItemClick:function(a,b,c,d,e,f){var g=this,h=g.getView(),i=e.target;if(i){var j=i.getAttribute("action"),k=b.get("id");switch(j){case"preview":alert("【"+k+"】"+i.getAttribute("title"));break;case"add":var l=g.lookupReference("media-mform");l||(l=Ext.create({reference:"media-mform",xtype:"media-mform"}),h.add(l)),l.setTitle("新增子栏目"),l.show();var m=l.down("form").getForm();m.findField("parentId").setValue(k),m.findField("parentPath").setValue(b.get("name")).setHidden(!1);break;case"headlineText":case"picture":case"article":alert("【"+k+"】"+i.getAttribute("title"))}}},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("media-mform");d||(d=Ext.create({reference:"media-mform",xtype:"media-mform"}),c.add(d)),d.setTitle("新增");var e=d,f=e.query('[itemId^="d-"]');Ext.each(f,function(a,b,c){a.enable(),a.setHidden(!1)}),d.show()},onSaveBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromData(a.action,a.text,c,{url:"/cn/admin/mediaUpdate"})},onDeleteBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/admin/mediaDelete"})},onEnabledBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/admin/mediaEnabled"})},onAbandonBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/admin/mediaAbandon"})},onEditBtnClicked:function(a){var b=this,c=b.getView(),d=a.up("grid"),e=b.lookupReference("media-mform");e||(e=Ext.create({reference:"media-mform",xtype:"media-mform"}),c.add(e)),e.setTitle("新增"),e.show();var f=d.getSelection()[0];e.down("form").getForm().loadRecord(f);var g=c.down("form"),h=g.query('[itemId^="d-"]'),i=c.down('button[action="reset"]'),j=c.down('button[action="submit"]');Ext.each(h,function(a,b,c){a.disable(),a.setHidden(!0)}),i.setHidden(!1),j.setHidden(!1)},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();d.isValid()&&d.submit({url:"/cn/admin/mediaCreate",method:"POST",submitEmptyText:!1,waitMsg:"上传中，稍等片刻...",success:function(a,b){switch(b.result.result){case"success":Ext.Msg.alert("提示","更新成功",function(a,b,d){c.hide();var e=c.up().down("media-mgrid"),f=e.getStore();f.getProxy().setExtraParam("page",1),f.reload()}).setIcon(Ext.Msg.INFO);break;case"failed":Ext.Msg.alert("更新失败",b.result.message).setIcon(Ext.Msg.WARNING)}},failure:function(a,b){Ext.Msg.alert("错误","服务器端异常，请联系管理员").setIcon(Ext.Msg.ERROR)}})}}),Ext.define("Admin.view.media.MediaSearchPanel",{extend:"Admin.view.common.panel.BaseSearchPanel",xtype:"media-sp",initComponent:function(){var a=this,b=a.subDefaults;Ext.apply(a,{items:[{defaults:b,items:[{xtype:"textfield",fieldLabel:"标题",emptyText:"",itemId:"search-title"},{itemId:"search-type",fieldLabel:"类型",xtype:"combo",store:[[0,"全部"],[MEDIA_TYPE_PICTURE,"图片"],[MEDIA_TYPE_AUDIO,"音频"],[MEDIA_TYPE_DOCUMENT,"文档"]],editable:!1},{xtype:"datefield",fieldLabel:"开始日期",itemId:"search-startdate",vtype:"daterange",endDateField:"search-enddate",editable:!1,format:"Y-m-d",submitFormat:"Y-m-d"},{xtype:"datefield",fieldLabel:"结束日期",itemId:"search-enddate",vtype:"daterange",editable:!1,startDateField:"search-startdate",format:"Y-m-d",submitFormat:"Y-m-d"},{xtype:"button",text:"查询",iconCls:"x-fa fa-search",action:"search"},{xtype:"button",text:"重置",iconCls:"x-fa fa-undo",action:"reset"}]}]}),a.callParent()}}),Ext.define("Admin.view.media.MediaGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"media-mgrid",initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/cn/admin/mediaList",reader:{type:"json",rootProperty:"data",totalProperty:"totalData"},extraParams:{pageSize:pageSize}},autoLoad:!0}),columns:[{text:"序号",dataIndex:"id",width:80},{text:'标题 <span class="admin-color-red">+</span>',dataIndex:"title",width:250,editor:{xtype:"textfield",allowBlank:!1}},{text:"类型",dataIndex:"type",width:80,renderer:function(a,b,c,d,e,f,g){switch(a){case MEDIA_TYPE_PICTURE:return"图片";case MEDIA_TYPE_AUDIO:return"音频";case MEDIA_TYPE_DOCUMENT:return"文档";default:return a}}},{text:"地址",dataIndex:"url",width:400},{text:"预览",dataIndex:"preview",width:50},{text:"状态",dataIndex:"status",width:100,renderer:function(a,b,c,d,e,f,g){switch(a){case 1:return'<span style="color: green">启用</span>';case 0:return'<span style="color: red">废弃</span>';default:return a}}},{text:"创建人",dataIndex:"user",width:80},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"上传",iconCls:"x-fa fa-upload",action:"add"},{xtype:"button",text:"启用",iconCls:"x-fa fa-check",disabled:!0,action:"enabled"},{xtype:"button",text:"废弃",iconCls:"x-fa fa-ban",disabled:!0,action:"abandon"},{xtype:"button",text:"编辑",iconCls:"x-fa fa-pencil-square-o",disabled:!0,action:"edit"},{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],plugins:[{ptype:"cellediting",clicksToEdit:2}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"id":return'<button class="admin-label-button" action="preview" title="预览栏目">预览</button><button class="admin-label-button" action="add" title="新增子栏目">新增</button><button class="admin-label-button" action="article" title="文章列表">文章</button><button class="admin-label-button" action="headlineText" title="栏目头条列表">头条</button><button class="admin-label-button" action="picture" title="栏目图片列表">图片</button>';default:return a}}}),Ext.define("Admin.view.media.MediaForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"media-mform",controller:"media",width:480,initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",bodyPadding:10,defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{name:"title",fieldLabel:"标题",allowBlank:!1},{itemId:"d-media-type",name:"type",fieldLabel:"类型",xtype:"radiogroup",hidden:!1,items:[{inputValue:MEDIA_TYPE_PICTURE,boxLabel:"图片",checked:!0},{inputValue:MEDIA_TYPE_AUDIO,boxLabel:"音频"},{inputValue:MEDIA_TYPE_DOCUMENT,boxLabel:"文档"}]},{itemId:"d-file-rule",name:"rule",fieldLabel:"规则",hidden:!1,xtype:"radiogroup",items:[{inputValue:0,boxLabel:"系统生成",checked:!0,labelAlign:"left"},{inputValue:1,boxLabel:"原始名称（覆盖）",labelAlign:"left"}]},{itemId:"d-file-type",xtype:"fieldcontainer",fieldLabel:"文件",hidden:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"filefield",name:"imgFile",allowBlank:!1,blankText:"请选择要上传的文件!",msgTarget:"side",flex:1,validator:function(b){var c,d;return(c=a.down("#d-media-type").getValue().type.toString())!=MEDIA_TYPE_PICTURE||(d=/^.+\.(jpg|jpeg|gif|png|bmp)$/,d.test(b))?c!=MEDIA_TYPE_AUDIO||(d=/^.+\.(mp3|wma)$/,d.test(b))?c!=MEDIA_TYPE_DOCUMENT||(d=/^.+\.(txt|pdf|doc|docx|xls|xlsx)$/,d.test(b))?!(1==a.down("#d-file-rule").getValue().rule.toString()&&(d=/(C:\\fakepath\\)+[a-zA-Z0-9_-]+\.[a-zA-Z0-9]+$/,!d.test(b)))||'非法文件名，原始名称只能是半角状态下的字母、数字、下划线"_"、连接符"-"':"不支持的文档类型，请上传txt|pdf|doc|docx|xls|xlsx格式的文档文件":"不支持的音频类型，请上传mp3|wma格式的音频文件":"不支持的图片类型，请上传jpg|jpeg|gif|png|bmp格式的图片"}}]},{name:"uId",hidden:!0,value:_am.currentUser.id},{name:"id",hidden:!0}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.media.Media",{extend:"Ext.panel.Panel",xtype:"media",requires:[],uses:[],controller:"media",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"north",xtype:"media-sp"},{region:"center",xtype:"media-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.ad.AdController",{extend:"Admin.controller.ViewController",alias:"controller.ad",module:"ad",url:"Super Awesome",init:function(){console.log(this)},control:{"ad-mgrid":{selectionchange:"onSelectionChange",itemclick:"onItemClick"},"ad-mgrid button[action=add]":{click:"onAddBtnClicked"},"ad-mgrid button[action=save]":{click:"onSaveBtnClicked"},"ad-mgrid button[action=delete]":{click:"onDeleteBtnClicked"},"ad-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"},"ad-mgrid button[action=enabled]":{click:"onEnabledBtnClicked"},"ad-mgrid button[action=abandon]":{click:"onAbandonBtnClicked"},"ad-mgrid button[action=edit]":{click:"onEditBtnClicked"},"ad-mgrid button[action=publish]":{click:"onPublishBtnClicked"},"ad-sp button[action=search]":{click:"onSearchPanelQuery"},"ad-sp button[action=reset]":{click:"onSearchPanelReset"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),d.module),g=e.down(f+d.getSearchGridSuffix()),h=b?b.length:0;0==h&&Ext.log("No selection"),g.down("button[action=save]").setDisabled(h<1),g.down("button[action=delete]").setDisabled(h<1),g.down("button[action=enabled]").setDisabled(h<1),g.down("button[action=abandon]").setDisabled(h<1)},onItemClick:function(a,b,c,d,e,f){var g=this,h=g.getView(),i=e.target;if(i){var j=i.getAttribute("action"),k=b.get("id");switch(j){case"preview":alert("【"+k+"】"+i.getAttribute("title"));break;case"add":var l=g.lookupReference("ad-mform");l||(l=Ext.create({reference:"ad-mform",xtype:"ad-mform"}),h.add(l)),l.setTitle("新增子栏目"),l.show();var m=l.down("form").getForm();m.findField("parentId").setValue(k),m.findField("parentPath").setValue(b.get("name")).setHidden(!1);break;case"headlineText":case"picture":case"article":alert("【"+k+"】"+i.getAttribute("title"))}}},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("ad-mform");d||(d=Ext.create({reference:"ad-mform",xtype:"ad-mform"}),c.add(d)),d.setTitle("新增");var e=d,f=e.query('[itemId^="d-"]');Ext.each(f,function(a,b,c){a.enable(),a.setHidden(!1)}),d.show()},onSaveBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromData(a.action,a.text,c,{url:"/cn/admin/adUpdate"})},onDeleteBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/admin/adDelete"})},onEnabledBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/admin/adEnabled"})},onAbandonBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/admin/adAbandon"})},onEditBtnClicked:function(a){var b=this,c=b.getView(),d=a.up("grid"),e=b.lookupReference("ad-mform");e||(e=Ext.create({reference:"ad-mform",xtype:"ad-mform"}),c.add(e)),e.setTitle("新增"),e.show();var f=d.getSelection()[0];e.down("form").getForm().loadRecord(f);var g=c.down("form"),h=g.query('[itemId^="d-"]'),i=c.down('button[action="reset"]'),j=c.down('button[action="submit"]');Ext.each(h,function(a,b,c){a.disable(),a.setHidden(!0)}),i.setHidden(!1),j.setHidden(!1)},onPublishBtnClicked:function(a){},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();d.isValid()&&d.submit({url:"/cn/admin/adCreate",method:"POST",submitEmptyText:!1,waitMsg:"上传中，稍等片刻...",success:function(a,b){switch(b.result.result){case"success":Ext.Msg.alert("提示","更新成功",function(a,b,d){c.hide();var e=c.up().down("ad-mgrid"),f=e.getStore();f.getProxy().setExtraParam("page",1),f.reload()}).setIcon(Ext.Msg.INFO);break;case"failed":Ext.Msg.alert("更新失败",b.result.message).setIcon(Ext.Msg.WARNING)}},failure:function(a,b){Ext.Msg.alert("错误","服务器端异常，请联系管理员").setIcon(Ext.Msg.ERROR)}})}}),Ext.define("Admin.view.ad.AdGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"ad-mgrid",initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/cn/admin/adList",reader:{type:"json",rootProperty:"data",totalProperty:"totalData"},extraParams:{pageSize:pageSize}},autoLoad:!0}),columns:[{text:"状态",dataIndex:"status",width:100,renderer:function(a,b,c,d,e,f,g){switch(a){case 1:return'<span style="color: green">启用</span>';case 0:return'<span style="color: red">废弃</span>';default:return a}}},{text:"序号",dataIndex:"id",width:80},{text:'标题 <span class="admin-color-red">+</span>',dataIndex:"name",width:250,editor:{xtype:"textfield",allowBlank:!1}},{text:'尺寸 <span class="admin-color-red">+</span>',dataIndex:"size",width:80,editor:{xtype:"textfield",allowBlank:!1}},{text:'链接 <span class="admin-color-red">+</span>',dataIndex:"url",width:400,editor:{xtype:"textfield",allowBlank:!1}},{text:'素材 <span class="admin-color-red">+</span>',dataIndex:"materialUrl",width:400,editor:{xtype:"textfield",allowBlank:!1}},{text:"更新人",dataIndex:"user",width:100},{text:"更新时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"新增",iconCls:"x-fa fa-plus",action:"add"},{xtype:"button",text:"审核",iconCls:"x-fa fa-check",disabled:!0,action:"enabled"},{xtype:"button",text:"废弃",iconCls:"x-fa fa-ban",disabled:!0,action:"abandon"},{xtype:"button",text:"删除",iconCls:"x-fa fa-trash-o",disabled:!0,action:"delete"},{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},{xtype:"button",text:"发布",iconCls:"x-fa fa-paper-plane-o",disabled:!0,action:"publish"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],plugins:[{ptype:"cellediting",clicksToEdit:2}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"id":return'<button class="admin-label-button" action="preview" title="预览栏目">预览</button><button class="admin-label-button" action="add" title="新增子栏目">新增</button><button class="admin-label-button" action="article" title="文章列表">文章</button><button class="admin-label-button" action="headlineText" title="栏目头条列表">头条</button><button class="admin-label-button" action="picture" title="栏目图片列表">图片</button>';default:return a}}}),Ext.define("Admin.view.ad.AdForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"ad-mform",controller:"ad",width:480,initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",bodyPadding:10,defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{name:"name",fieldLabel:"标题",allowBlank:!1},{name:"size",fieldLabel:"尺寸",allowBlank:!1},{name:"url",fieldLabel:"链接",allowBlank:!1},{name:"materialUrl",fieldLabel:"素材",allowBlank:!1},{name:"uId",hidden:!0,value:_am.currentUser.id},{name:"id",hidden:!0}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.ad.Ad",{extend:"Ext.panel.Panel",xtype:"ad",requires:[],uses:[],controller:"ad",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"ad-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.account.AccountController",{extend:"Admin.controller.ViewController",alias:"controller.account",module:"account",url:"Super Awesome",init:function(){console.log(this)},control:{"account-mgrid":{selectionchange:"onSelectionChange",itemclick:"onItemClick"},"account-mgrid button[action=add]":{click:"onAddBtnClicked"},"account-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"},"account-mgrid button[action=save]":{click:"onSaveBtnClicked"},"account-mgrid button[action=enabled]":{click:"onEnabledBtnClicked"},"account-mgrid button[action=abandon]":{click:"onAbandonBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),d.module,b?b.length:0);0==f&&Ext.log("No selection"),e.down("button[action=save]").setDisabled(f<1),e.down("button[action=enabled]").setDisabled(f<1),e.down("button[action=abandon]").setDisabled(f<1)},onItemClick:function(a,b,c,d,e,f){var g=this,h=g.getView(),i=e.target;if(i){var j=i.getAttribute("action"),k=b.get("id");switch(j){case"preview":alert("【"+k+"】"+i.getAttribute("title"));break;case"add":var l=g.lookupReference("account-mform");l||(l=Ext.create({reference:"account-mform",xtype:"account-mform"}),h.add(l)),l.setTitle("新增子栏目"),l.show();var m=l.down("form").getForm();m.findField("parentId").setValue(k),m.findField("parentPath").setValue(b.get("name")).setHidden(!1);break;case"headlineText":case"picture":case"article":alert("【"+k+"】"+i.getAttribute("title"))}}},onEditBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form"),e=d.query('[itemId^="d-"]'),f=d.query('[itemId^="v-"]'),g=c.down('button[action="cancel"]'),h=c.down('button[action="submit"]');Ext.each(e,function(a,b,c){a.setHidden(!0)}),Ext.each(f,function(a,b,c){a.setHidden(!1)}),a.setHidden(!0),g.setHidden(!1),h.setHidden(!1)},onCancelBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form"),e=d.query('[itemId^="d-"]'),f=d.query('[itemId^="v-"]'),g=c.down('button[action="edit"]'),h=c.down('button[action="submit"]');Ext.each(e,function(a,b,c){a.setHidden(!1)}),Ext.each(f,function(a,b,c){a.setHidden(!0)}),a.setHidden(!0),h.setHidden(!0),g.setHidden(!1)},onEditSettingSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();d.isValid()&&d.submit({url:"/cn/admin/userUpdate",method:"POST",submitEmptyText:!1,success:function(a,b){switch(b.result.result){case"success":Ext.Msg.alert("提示","更新成功",function(a,b,c){window.location.reload()}).setIcon(Ext.Msg.INFO);break;case"failed":Ext.Msg.alert("警告","更新失败").setIcon(Ext.Msg.WARNING)}},failure:function(a,b){Ext.Msg.alert("错误","服务器端异常，请联系管理员").setIcon(Ext.Msg.ERROR)}})},onEditPwdSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();d.isValid()&&d.submit({url:"/cn/admin/userChangePassWord",method:"POST",submitEmptyText:!1,success:function(a,b){switch(b.result.result){case"success":Ext.Msg.alert("提示","更新成功").setIcon(Ext.Msg.INFO);break;case"failed":Ext.Msg.alert("警告","更新失败："+b.result.password).setIcon(Ext.Msg.WARNING)}},failure:function(a,b){Ext.Msg.alert("错误","服务器端异常，请联系管理员").setIcon(Ext.Msg.ERROR)}})},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("account-mform");d||(d=Ext.create({reference:"account-mform",xtype:"account-mform"}),c.add(d)),d.setTitle("新增"),d.show()},onAddUserSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();d.isValid()&&d.submit({url:"/cn/admin/userAdd",method:"POST",submitEmptyText:!1,success:function(b,d){switch(d.result.result){case"success":Ext.Msg.alert("提示","更新成功",function(b,d,e){c.hide();var f=(a.up("grid"),a.up("grid").getStore());f.getProxy().setExtraParam("page",1),f.reload()}).setIcon(Ext.Msg.INFO);break;case"failed":Ext.Msg.alert("警告","更新失败："+d.result.message).setIcon(Ext.Msg.WARNING)}},failure:function(a,b){Ext.Msg.alert("错误","服务器端异常，请联系管理员").setIcon(Ext.Msg.ERROR)}})},onSaveBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromData(a.action,a.text,c,{url:"/cn/admin/accountUpdate"})},onEnabledBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/admin/accountEnabled"})},onAbandonBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"/cn/admin/accountAbandon"})}}),Ext.define("Admin.view.account.AccountEditSetting",{extend:"Ext.panel.Panel",xtype:"account-setting",requires:[],controller:"account",keyMap:{"CTRL+ENTER":"onEditSettingSubmitBtnClicked",scope:"controller"},initComponent:function(){var a=this,b={id:_am.currentUser.id,account:_am.currentUser.account,name:_am.currentUser.name,phone:_am.currentUser.phone,mail:_am.currentUser.mail,depict:_am.currentUser.depict};Ext.apply(a,{items:{xtype:"form",defaults:{anchor:"50%",labelAlign:"right",msgTarget:"side"},bodyPadding:10,buttonAlign:"left",border:!1,defaultType:"textfield",items:[{xtype:"displayfield",fieldLabel:"帐号",value:b.account},{xtype:"displayfield",itemId:"d-name",fieldLabel:"姓名",value:b.name},{xtype:"displayfield",itemId:"d-phone",fieldLabel:"手机",value:b.phone},{xtype:"displayfield",itemId:"d-email",fieldLabel:"邮箱",value:b.mail},{xtype:"displayfield",itemId:"d-desc",fieldLabel:"描述",value:b.depict},{itemId:"v-name",name:"name",beforeLabelTextTpl:'<span class="admin-color-red">* </span>',fieldLabel:"姓名",hidden:!0,allowBlank:!1,blankText:"请填写您的姓名",maxLength:20,maxLengthText:"姓名不能超过20个字",value:b.name},{itemId:"v-phone",vtype:"phone",name:"phone",fieldLabel:"手机",hidden:!0,value:b.phone},{itemId:"v-email",vtype:"email",name:"mail",fieldLabel:"邮箱",maxLength:50,maxLengthText:"邮箱不能超过50个字符",hidden:!0,value:b.mail},{itemId:"v-desc",xtype:"textarea",name:"depict",fieldLabel:"描述",maxLength:50,maxLengthText:"描述不能超过50个字符",hidden:!0,value:b.depict},{name:"account",hidden:!0,value:b.account},{name:"id",hidden:!0,value:b.id}],tbar:[{text:"修改",iconCls:"x-fa fa-pencil-square-o",action:"edit",handler:"onEditBtnClicked"},{text:"取消",iconCls:"x-fa fa-undo",hidden:!0,action:"cancel",handler:"onCancelBtnClicked"},{text:"更新",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Enter",disabled:!0,formBind:!0,hidden:!0,action:"submit",handler:"onEditSettingSubmitBtnClicked"}]}}),a.callParent()}}),Ext.define("Admin.view.account.AccountEditPwd",{extend:"Ext.panel.Panel",xtype:"account-editpwd",requires:[],controller:"account",keyMap:{"CTRL+ENTER":"onEditPwdSubmitBtnClicked",scope:"controller"},initComponent:function(){var a=this;Ext.apply(a,{items:{xtype:"form",defaults:{anchor:"30%",labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},bodyPadding:10,buttonAlign:"left",border:!1,defaultType:"textfield",items:[{inputType:"password",name:"old-password",beforeLabelTextTpl:'<span class="admin-color-red">* </span>',fieldLabel:"旧密码",allowBlank:!1,blankText:"请填写您的旧密码"},{inputType:"password",itemId:"new-password",name:"new-password",beforeLabelTextTpl:'<span class="admin-color-red">* </span>',fieldLabel:"新密码",allowBlank:!1,blankText:"6-20位，由数字、字母(大小写)、特殊符号构成",emptyText:"6-20位，由数字、字母(大小写)、特殊符号构成"},{vtype:"password",inputType:"password",initialPassField:"new-password",name:"re-password",beforeLabelTextTpl:'<span class="admin-color-red">* </span>',fieldLabel:"密码确认",allowBlank:!1,blankText:"再次输入新密码进行确认"},{name:"id",hidden:!0,value:_am.currentUser.id}],tbar:[{text:"更新",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Enter",disabled:!0,formBind:!0,action:"submit",handler:"onEditPwdSubmitBtnClicked"}]}}),a.callParent()}}),Ext.define("Admin.view.account.AccountGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"account-mgrid",requires:[],controller:"account",initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/cn/admin/accountList",reader:{type:"json",rootProperty:"data",totalProperty:"totalData"},extraParams:{pageSize:pageSize}},autoLoad:!0}),columns:[{text:"序号",dataIndex:"id",width:80},{text:"账号",dataIndex:"account",width:100},{text:'姓名 <span class="admin-color-red">+</span>',dataIndex:"name",width:100,editor:{xtype:"textfield",allowBlank:!1}},{text:'手机 <span class="admin-color-red">+</span>',dataIndex:"phone",width:120,editor:{vtype:"phone",allowBlank:!1,maxLength:20}},{text:'邮箱 <span class="admin-color-red">+</span>',dataIndex:"mail",width:200,editor:{vtype:"email",allowBlank:!1,maxLength:50}},{text:"描述",dataIndex:"depict",width:250},{text:"状态",dataIndex:"status",width:60,renderer:function(a,b,c,d,e,f,g){switch(a){case 1:return'<span style="color: green">启用</span>';case 0:return'<span style="color: red">禁用</span>';default:return a}}},{text:"最后登录时间",dataIndex:"lastLoginDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:130},{text:"更新时间",dataIndex:"updateDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:130},{text:"创建时间",dataIndex:"createDate",xtype:"datecolumn",format:"y-m-d H:i:s",width:130}],tbar:[{xtype:"button",text:"新增",iconCls:"x-fa fa-plus",action:"add"},{xtype:"button",text:"启用",iconCls:"x-fa fa-check",disabled:!0,action:"enabled"},{xtype:"button",text:"禁用",iconCls:"x-fa fa-ban",disabled:!0,action:"abandon"},{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],plugins:[{ptype:"cellediting",clicksToEdit:2}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"id":return'<button class="admin-label-button" action="preview" title="预览栏目">预览</button><button class="admin-label-button" action="add" title="新增子栏目">新增</button><button class="admin-label-button" action="article" title="文章列表">文章</button><button class="admin-label-button" action="headlineText" title="栏目头条列表">头条</button><button class="admin-label-button" action="picture" title="栏目图片列表">图片</button>';default:return a}}}),Ext.define("Admin.view.account.AccountForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"account-mform",requires:[],controller:"account",width:480,initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",bodyPadding:10,defaults:{anchor:"100%",labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{name:"account",fieldLabel:"账号",allowBlank:!1,beforeLabelTextTpl:'<span class="admin-color-red">* </span>',emptyText:"请谨慎填写账户名，保存后无法修改",maxLength:20,maxLengthText:"账户名不能超过20个字"},{name:"name",beforeLabelTextTpl:'<span class="admin-color-red">* </span>',fieldLabel:"姓名",allowBlank:!1,emptyText:"请填写您的姓名",maxLength:20,maxLengthText:"姓名不能超过20个字"},{inputType:"password",itemId:"new-password",name:"new-password",beforeLabelTextTpl:'<span class="admin-color-red">* </span>',fieldLabel:"新密码",allowBlank:!1,blankText:"6-20位，由数字、字母(大小写)、特殊符号构成",emptyText:"6-20位，由数字、字母(大小写)、特殊符号构成"},{vtype:"password",inputType:"password",initialPassField:"new-password",name:"password",beforeLabelTextTpl:'<span class="admin-color-red">* </span>',fieldLabel:"密码确认",allowBlank:!1,blankText:"再次输入新密码进行确认"},{vtype:"phone",name:"phone",emptyText:"请输入11位手机号码",fieldLabel:"手机"},{vtype:"email",name:"mail",fieldLabel:"邮箱",maxLength:50,maxLengthText:"邮箱不能超过50个字符"},{xtype:"textarea",name:"depict",fieldLabel:"描述",maxLength:50,maxLengthText:"描述不能超过50个字符"}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onAddUserSubmitBtnClicked"}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.auth.function.FunctionController",{extend:"Admin.controller.ViewController",alias:"controller.auth-function",module:"auth-function",url:"Super Awesome",init:function(){console.log(this)},control:{"auth-function-mgrid":{selectionchange:"onSelectionChange"},"auth-function-mgrid button[action=add]":{click:"onAddBtnClicked"},"auth-function-mgrid button[action=save]":{click:"onSaveBtnClicked"},"auth-function-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),e.down("auth-function-mgrid")),g=b?b.length:0;0==g&&Ext.log("No selection"),f.down("button[action=save]").setDisabled(1!==g)},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("auth-function-mform");d||(d=Ext.create({reference:"auth-function-mform",xtype:"auth-function-mform"}),c.add(d)),d.setTitle("新增"),d.show()},onSaveBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromData(a.action,a.text,c,{url:_ADMIN.root+"/auth-function/update.do"})},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm();b.formSubmit(d,{url:_ADMIN.root+"/auth-function/create.do"},function(a,b){Ext.ux.Msg.info("保存成功",function(){c.hide();var a=c.up().down("auth-function-mgrid"),b=a.getStore();b.getProxy().setExtraParam("page",1),b.reload(),a.getSelectionModel().deselectAll()})})}}),Ext.define("Admin.view.auth.function.FunctionMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"auth-function-mgrid",viewModel:{data:{rowCount:null}},initComponent:function(){var a=this,b=a.getViewModel();Ext.apply(a,{store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:_ADMIN.root+"/auth-function/list.do",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0,listeners:{load:function(a,c,d,e,f){b.set("rowCount",c.length)}}}),columns:[{text:"ID",dataIndex:"id",width:80},{text:'名称 <span class="admin-color-red">+</span>',dataIndex:"name",editor:{xtype:"textfield",allowBlank:!1},flex:1}],tbar:[{xtype:"button",text:"新增",iconCls:"x-fa fa-plus-circle",action:"add"},{xtype:"button",text:"保存",iconCls:"x-fa fa-floppy-o",disabled:!0,action:"save"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],bbar:{items:["->",{xtype:"component",bind:"共 {rowCount} 条"}]},plugins:[{ptype:"cellediting",clicksToEdit:2}]}),a.callParent()}}),Ext.define("Admin.view.auth.function.FunctionMainForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"auth-function-mform",controller:"auth-function",maximizable:!1,initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",bodyPadding:10,defaults:{anchor:"100%",labelWidth:60,labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{fieldLabel:"ID",name:"id"},{name:"name",fieldLabel:"名称",allowBlank:!1}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.auth.function.Function",{extend:"Ext.panel.Panel",xtype:"auth-function",requires:[],uses:[],controller:"auth-function",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"auth-function-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.auth.role.RoleController",{extend:"Admin.controller.ViewController",alias:"controller.auth-role",module:"auth-role",url:"Super Awesome",init:function(){console.log(this)},control:{"auth-role-mgrid":{selectionchange:"onSelectionChange"},"auth-role-mgrid button[action=add]":{click:"onAddBtnClicked"},"auth-role-mgrid button[action=edit]":{click:"onEditBtnClicked"},
"auth-role-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),e.down("auth-role-mgrid")),g=b?b.length:0;0==g&&Ext.log("No selection"),f.down("button[action=edit]").setDisabled(1!==g)},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("auth-role-mform");d||(d=Ext.create({reference:"auth-role-mform",xtype:"auth-role-mform"}),c.add(d)),d.setTitle("新增"),d.show()},onEditBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("auth-role-mform");d||(d=Ext.create({reference:"auth-role-mform",xtype:"auth-role-mform"}),c.add(d)),d.setTitle("修改"),d.show();var e=c.down("auth-role-mgrid"),f=e.getSelection()[0];d.down("form").getForm().loadRecord(f)},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form").getForm(),e=d.findField("id").getValue(),f=e?"update.do":"create.do";b.formSubmit(d,{url:_ADMIN.root+"/auth-role/"+f},function(a,b){Ext.ux.Msg.info("保存成功",function(){c.hide();var a=c.up().down("auth-role-mgrid"),b=a.getStore();b.getProxy().setExtraParam("page",1),b.reload(),a.getSelectionModel().deselectAll()})})}}),Ext.define("Admin.view.auth.role.RoleMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"auth-role-mgrid",viewModel:{data:{rowCount:null}},initComponent:function(){var a=this,b=a.getViewModel();Ext.apply(a,{store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:_ADMIN.root+"/auth-role/list.do",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0,listeners:{load:function(a,c,d,e,f){b.set("rowCount",c.length)}}}),columns:[{text:"ID",dataIndex:"id",width:80},{text:"名称",dataIndex:"name"},{text:"级别",dataIndex:"rank"},{text:"描述",dataIndex:"description",renderer:a.renderer,width:200},{text:"功能",dataIndex:"function_names",renderer:a.renderer,flex:1}],tbar:[{xtype:"button",text:"新增",iconCls:"x-fa fa-plus-circle",action:"add"},{xtype:"button",text:"修改",iconCls:"x-fa fa-pencil-square-o",disabled:!0,action:"edit"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],bbar:{items:["->",{xtype:"component",bind:"共 {rowCount} 条"}]}}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"description":return b.tdAttr='data-qtip="'+a+'"',a;case"function_names":return b.tdAttr='data-qtip="'+a+'"',a.join(",");default:return a}}}),Ext.define("Admin.view.auth.role.RoleMainForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"auth-role-mform",controller:"auth-role",maximizable:!1,initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",bodyPadding:10,defaults:{anchor:"100%",labelWidth:60,labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{fieldLabel:"roleId",name:"id",hidden:!0},{name:"name",fieldLabel:"名称",allowBlank:!1},{xtype:"numberfield",name:"rank",fieldLabel:"级别",allowBlank:!1,allowDecimals:!1,minValue:0,value:0},{xtype:"textarea",name:"description",beforeLabelTextTpl:"",fieldLabel:"描述",maxLength:255},{xtype:"fieldcontainer",fieldLabel:"功能",layout:"fit",items:{xtype:"itemselector",name:"function_ids",itemId:"function_ids",width:"100%",height:300,scrollable:"y",imagePath:"../ux/images/",buttons:["add","remove"],buttonsText:["增加","删除"],store:{proxy:{type:"ajax",url:_ADMIN.root+"/auth-function/list.do",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0},displayField:"name",valueField:"id",allowBlank:!1,msgTarget:"side"}}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:b}),a.callParent()}}),Ext.define("Admin.view.auth.role.Role",{extend:"Ext.panel.Panel",xtype:"auth-role",requires:[],uses:[],controller:"auth-role",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"auth-role-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.auth.acl.AclController",{extend:"Admin.controller.ViewController",alias:"controller.auth-acl",module:"auth-acl",url:"Super Awesome",init:function(){console.log(this)},control:{"auth-acl-mgrid":{selectionchange:"onSelectionChange"},"auth-acl-mgrid button[action=add]":{click:"onAddBtnClicked"},"auth-acl-mgrid button[action=edit]":{click:"onEditBtnClicked"},"auth-acl-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onSelectionChange:function(a,b,c){var d=this,e=d.getView(),f=(d.getViewModel(),e.down("auth-acl-mgrid")),g=b?b.length:0;0==g&&Ext.log("No selection"),f.down("button[action=edit]").setDisabled(1!==g)},onAddBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("auth-acl-mform");d||(d=Ext.create({reference:"auth-acl-mform",xtype:"auth-acl-mform"}),c.add(d));var e=d.down("form").getForm();e.findField("department").setHidden(!0),e.findField("name").setHidden(!0),d.down("#form-userInfo").setHidden(!1),d.setTitle("新增"),d.show()},onEditBtnClicked:function(a){var b=this,c=b.getView(),d=b.lookupReference("auth-acl-mform");d||(d=Ext.create({reference:"auth-acl-mform",xtype:"auth-acl-mform"}),c.add(d));var e=d.down("form").getForm();e.findField("department").setHidden(!1),e.findField("name").setHidden(!1),d.down("#form-userInfo").setHidden(!0),d.setTitle("修改"),d.show();var f=c.down("auth-acl-mgrid"),g=f.getSelection()[0];d.down("form").getForm().loadRecord(g)},onResetBtnClicked:function(a){var b=this,c=b.getView();c.down("form").getForm().reset(),c.down("#form-grid-userInfo").getStore().removeAll()},onSubmitBtnClicked:function(a){var b=this,c=b.getView(),d=c.down("form"),e=d.getForm(),f=e.findField("id").getValue(),g="update.do",h=[],i=function(){};if(!f){g="create.do";var j=d.down("#form-grid-userInfo").getStore();if(j.each(function(a){h.push(a.get("value"))}),0==h.length)return void Ext.Msg.alert("请添加权限用户");i=function(){j.removeAll()}}b.formSubmit(e,{url:_ADMIN.root+"/auth-acl/"+g,params:{userInfo_ids:h.join(",")}},function(a,b){Ext.ux.Msg.info("保存成功",function(){c.hide();var a=c.up().down("auth-acl-mgrid"),b=a.getStore();b.getProxy().setExtraParam("page",1),b.reload(),a.getSelectionModel().deselectAll(),i()})})},onDeleteUserInfoBtnByFormClicked:function(a,b){for(var c=this,d=c.getView().down("#form-grid-userInfo"),e=d.getStore(),f=d.getSelection(),g=0;g<f.length;g++)for(var h=0;h<e.getCount();h++)if(e.getAt(h).get("id")==f[g].get("id")){e.removeAt(h);break}}}),Ext.define("Admin.view.auth.acl.AclMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"auth-acl-mgrid",viewModel:{data:{rowCount:null}},initComponent:function(){var a=this,b=a.getViewModel();Ext.apply(a,{store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:_ADMIN.root+"/auth-acl/list.do",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0,listeners:{load:function(a,c,d,e,f){b.set("rowCount",c.length)}}}),columns:[{text:"ID",dataIndex:"id",width:80},{text:"用户名",dataIndex:"account"},{text:"姓名",dataIndex:"name"},{text:"部门",dataIndex:"department",renderer:a.renderer,width:200},{text:"角色",dataIndex:"role_names",renderer:a.renderer,flex:1}],tbar:[{xtype:"button",text:"新增",iconCls:"x-fa fa-plus-circle",action:"add"},{xtype:"button",text:"修改",iconCls:"x-fa fa-pencil-square-o",disabled:!0,action:"edit"},"-",{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}],bbar:{items:["->",{xtype:"component",bind:"共 {rowCount} 条"}]}}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"description":return b.tdAttr='data-qtip="'+a+'"',a;case"function_names":return b.tdAttr='data-qtip="'+a+'"',a.join(",");default:return a}}}),Ext.define("Admin.view.auth.acl.AclMainForm",{extend:"Admin.view.common.window.BaseFormWindow",xtype:"auth-acl-mform",controller:"auth-acl",maximizable:!1,initComponent:function(){var a=this,b=Ext.create({xtype:"form",layout:"anchor",bodyPadding:10,defaults:{anchor:"100%",labelWidth:60,labelAlign:"right",msgTarget:"side",beforeLabelTextTpl:'<span class="admin-color-red">* </span>'},defaultType:"textfield",items:[{fieldLabel:"userInfoId",name:"id",hidden:!0},{xtype:"displayfield",fieldLabel:"部门",name:"department",hidden:!0},{xtype:"displayfield",fieldLabel:"姓名",name:"name",hidden:!0},{xtype:"fieldcontainer",fieldLabel:"角色",layout:"fit",items:{xtype:"itemselector",name:"role_ids",itemId:"role_ids",width:"100%",height:200,scrollable:"y",imagePath:"../ux/images/",buttons:["add","remove"],buttonsText:["增加","删除"],store:{proxy:{type:"ajax",url:_ADMIN.root+"/auth-role/list.do",reader:{type:"json",rootProperty:"rows"}},autoLoad:!0},displayField:"name",valueField:"id",allowBlank:!1,msgTarget:"side"}},{xtype:"fieldcontainer",itemId:"form-userInfo",fieldLabel:"用户",layout:"fit",items:{xtype:"gridpanel",itemId:"form-grid-userInfo",scrollable:!0,width:220,height:200,columnLines:!0,loadMask:!0,hideHeaders:!0,viewConfig:{enableTextSelection:!0},selModel:{selType:"checkboxmodel"},store:{fields:["text","value"]},columns:[{dataIndex:"value",text:"ID",hidden:!0},{dataIndex:"text",text:"名称",flex:1}],tbar:[{xtype:"combo",itemId:"form-combo-userInfo",store:{proxy:{type:"ajax",url:_ADMIN.root+"/user/autocomplete_json.do",reader:{type:"json",rootProperty:"rows"}},fields:["text","value"]},queryParam:"q",displayField:"text",valueField:"value",triggerAction:"all",typeAhead:!0,typeAheadDelay:350,forceSelection:!0,minChars:1,emptyText:"请选择",matchFieldWidth:!1,listConfig:{width:200},listeners:{select:function(a,b,c){var d=a.up("form").down("#form-grid-userInfo"),e=d.getStore();if(e.getCount()>0)for(var f=0;f<e.getCount()&&e.getAt(f).get("id")!=b.get("id");f++)e.add(b);else e.add(b)},beforequery:function(a){a.query||(a.cancel=!0)}}},"->",{iconCls:"x-fa fa-minus-circle",componentCls:"admin-color-red",handler:"onDeleteUserInfoBtnByFormClicked"}]}}],buttons:[{text:"重置",iconCls:"x-fa fa-undo",action:"reset",handler:"onResetBtnClicked"},{text:"提交",iconCls:"x-fa fa-floppy-o",tooltip:"快捷键：Ctrl+Enter",disabled:!0,formBind:!0,action:"submit",handler:"onSubmitBtnClicked"}]});Ext.apply(a,{items:b,listeners:{beforeshow:"onResetBtnClicked"}}),a.callParent()}}),Ext.define("Admin.view.auth.acl.Acl",{extend:"Ext.panel.Panel",xtype:"auth-acl",requires:[],uses:[],controller:"auth-acl",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"center",xtype:"auth-acl-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.log.LogController",{extend:"Admin.controller.ViewController",alias:"controller.log",module:"log",url:"Super Awesome",init:function(){console.log(this)},control:{"log-sp button[action=search]":{click:"onSearchPanelQuery"},"log-sp button[action=reset]":{click:"onSearchPanelReset"},"log-mgrid":{itemclick:"onItemClick"},"log-mgrid button[action=refresh]":{click:"onRefreshBtnClicked"}},onItemClick:function(a,b,c,d,e,f){var g=this,h=(g.getView(),e.target);if(h){switch(h.getAttribute("action")){case"show-json":var i=JSON.stringify(b.get("logDetail"));window.open("http://jsoneditoronline.org/?json="+encodeURIComponent(i))}}},onBtnClicked:function(a){var b=this,c=a.up("grid");b.sendAjaxFromIds(a.action,a.text,c,{url:"data/ajax.json?"+a.action})}}),Ext.define("Admin.view.log.LogSearchPanel",{extend:"Admin.view.common.panel.BaseSearchPanel",xtype:"log-sp",initComponent:function(){var a=this,b=a.subDefaults;Ext.apply(a,{items:[{defaults:b,items:[{xtype:"combo",fieldLabel:"模块",itemId:"search-name",store:[[100,"全部"],[101,"媒体管理"],[102,"广告管理"]],editable:!1},{xtype:"combo",fieldLabel:"动作",itemId:"search-action",store:[[100,"全部"],[200,"新增"],[201,"修改"],[202,"删除"],[203,"启用"],[204,"废弃"],[205,"初稿"],[206,"已签"],[207,"返工"],[208,"已发"],[209,"已删"]],editable:!1},{xtype:"textfield",fieldLabel:"模糊查询",emptyText:"操作者",itemId:"search-query",width:300},{xtype:"button",text:"查询",iconCls:"x-fa fa-search",action:"search"},{xtype:"button",text:"重置",iconCls:"x-fa fa-undo",action:"reset"}]}]}),a.callParent()}}),Ext.define("Admin.view.log.LogMainGrid",{extend:"Admin.view.common.panel.BaseGridPanel",xtype:"log-mgrid",initComponent:function(){var a=this;Ext.apply(a,{store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:"/cn/admin/logList",reader:{type:"json",rootProperty:"data",totalProperty:"totalData"},extraParams:{pageSize:pageSize}},autoLoad:!0}),columns:[{text:"ID",dataIndex:"id",width:80},{text:"模块",dataIndex:"name",width:150},{text:"动作",dataIndex:"action",width:100},{text:"内容",dataIndex:"content",flex:1},{text:"IP",dataIndex:"ip",width:130},{text:"操作人",dataIndex:"account",width:80},{text:"操作时间",dataIndex:"createDate",xtype:"datecolumn",format:"Y-m-d H:i:s",width:150}],tbar:[{xtype:"button",text:"刷新",iconCls:"x-fa fa-refresh",action:"refresh"}]}),a.callParent()},renderer:function(a,b,c,d,e,f,g){switch(this.getHeaderContainer().getHeaderAtIndex(e).dataIndex){case"logDetail":return a&&"object"==typeof a?'<button class="x-fa fa-magic admin-label-button admin-color-brown" action="show-json" title="想看我变魔术吗？赶快点击我吧！"></button>'+JSON.stringify(a):a;default:return a}}}),Ext.define("Admin.view.log.Log",{extend:"Ext.panel.Panel",xtype:"log",requires:[],controller:"log",layout:"border",margin:5,initComponent:function(){var a=this;Ext.apply(a,{items:[{region:"north",xtype:"log-sp"},{region:"center",xtype:"log-mgrid"}]}),a.callParent()}}),Ext.define("Admin.view.main.HomePage",{extend:"Ext.container.Container",xtype:"homepage",requires:[],layout:"responsivecolumn",items:[{xtype:"panel",title:"更新日志",html:"<ul><li>（1）登录 -> 1个页面；</li><li>（2）首页 -> 1个页面；unfinished:查看文章</li><li>（3）账户资料（资料设置、密码修改）-> 2个页面；</li><li>（4）栏目维护（目录维护、新增目录、模板维护、标签维护）-> 4个页面；</li><li>（5）内容管理（新增新闻）-> 1个页面；</li><li>（6）内容管理（新闻法讯 -> 图片头条、新闻法讯 -> 栏目图片列表） -> 2个页面；</li><li>（7）系统安全（角色管理）-> 1个页面；</li></ul>"}]}),Ext.define("Admin.store.Navigation",{extend:"Ext.data.TreeStore",alias:"store.navigation",storeId:"Navigation",filterer:"bottomup",root:{text:"Login",viewType:"login",expanded:!0,iconCls:"x-fa fa-home",description:""},proxy:{type:"ajax",url:"/app/temp/data/navs.json",reader:{type:"json",rootProperty:"children"},autoLoad:!0},listeners:{load:function(a,b,c,d,e,f){a.each(function(a){var b=a.get("text"),c=a.get("iconCls"),d=a.get("tier"),e=a.get("split");if(!b)return a.remove(),!0;c||a.set("iconCls","x-fa fa-file-text-o"),d||a.set("tier","standard"),e||a.set("split",!1)})}},constructor:function(a){var b=this,c=Ext.getVersion().parts;b.ver=new Ext.Version(c[0]+"."+c[1]+"."+c[2]),a=Ext.apply({root:Ext.clone(this.rootData)},a),this.callParent([a])}}),Ext.Loader.setConfig({enabled:!0,disableCaching:!1}),Ext.QuickTips.init(),Ext.application({name:"Admin",requires:[],controllers:["AppController"],views:["common.window.BaseWindow","common.window.BaseFormWindow","common.panel.BaseGridPanel","common.panel.BaseSearchPanel","common.charts.BaseChart","login.Login","main.Main","workbench.Workbench","content.index.nav.Nav","content.Content","content.recycle.Recycle","content.index.embed.Futian","content.index.embed.Contact","content.index.embed.Focus","content.index.embed.Fawu","publish.Publish","serial.Serial","category.Category","template.Template","keyword.Keyword","media.Media","ad.Ad","account.AccountEditSetting","account.AccountEditPwd","account.AccountGrid","account.AccountForm","auth.function.Function","auth.role.Role","auth.acl.Acl","log.Log","main.HomePage"],stores:["Navigation"],defaultToken:"",launch:function(){Ext.create("Admin.store.Navigation",{storeId:"navigation"});var a="Admin.view.main.Main";_am.currentUser.name?this.setMainView({xclass:a}):(a="Admin.view.login.Login",Ext.create(a))},onAppUpdate:function(){Ext.Msg.confirm("Application Update","This application has an update, reload?",function(a){"yes"===a&&window.location.reload()})}});